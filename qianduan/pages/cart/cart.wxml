<!--pages/cart/cart.wxml - è´­ç‰©è½¦-->
<view class="container">
  <!-- ç©ºè´­ç‰©è½¦ -->
  <view class="empty-cart" wx:if="{{!loading && cartItems.length === 0}}">
    <text class="empty-icon">ğŸ›’</text>
    <text class="empty-title">è´­ç‰©è½¦æ˜¯ç©ºçš„</text>
    <text class="empty-desc">å¿«å»æŒ‘é€‰å¿ƒä»ªçš„å•†å“å§</text>
    <navigator url="/pages/index/index" open-type="switchTab" class="btn btn-primary">
      å»é€›é€›
    </navigator>
  </view>

  <!-- è´­ç‰©è½¦åˆ—è¡¨ -->
  <view class="cart-list" wx:if="{{cartItems.length > 0}}">
    <view class="cart-item" wx:for="{{cartItems}}" wx:key="id">
      <!-- é€‰æ‹©æ¡† -->
      <view class="checkbox-wrapper" bindtap="onToggleSelect" data-index="{{index}}">
        <view class="checkbox {{item.selected ? 'checked' : ''}}">
          <text wx:if="{{item.selected}}">âœ“</text>
        </view>
      </view>

      <!-- å•†å“å›¾ç‰‡ -->
      <view class="product-image-wrapper" bindtap="onProductTap" data-item="{{item}}">
        <image class="product-image" 
               src="{{item.firstImage || '/assets/images/placeholder.svg'}}" 
               mode="aspectFill"></image>
      </view>

      <!-- å•†å“ä¿¡æ¯ -->
      <view class="product-info">
        <text class="product-name" bindtap="onProductTap" data-item="{{item}}">
          {{item.productName}}
        </text>
        <text class="product-spec" wx:if="{{item.sku && item.sku.spec_value}}">
          {{item.sku.spec_value}}
        </text>
        
        <view class="price-quantity-row">
          <text class="product-price">Â¥{{item.price}}</text>
          
          <!-- æ•°é‡æ§åˆ¶ -->
          <view class="quantity-control">
            <view class="qty-btn {{item.quantity <= 1 ? 'disabled' : ''}}" 
                  bindtap="onQuantityChange" 
                  data-index="{{index}}" 
                  data-type="minus">âˆ’</view>
            <text class="qty-num">{{item.quantity}}</text>
            <view class="qty-btn" 
                  bindtap="onQuantityChange" 
                  data-index="{{index}}" 
                  data-type="plus">+</view>
          </view>
        </view>
      </view>

      <!-- åˆ é™¤æŒ‰é’® -->
      <view class="delete-btn" bindtap="onDelete" data-index="{{index}}">
        <text>ğŸ—‘ï¸</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- åº•éƒ¨ç»“ç®—æ  -->
  <view class="checkout-bar" wx:if="{{cartItems.length > 0}}">
    <view class="select-all" bindtap="onToggleSelectAll">
      <view class="checkbox {{selectAll ? 'checked' : ''}}">
        <text wx:if="{{selectAll}}">âœ“</text>
      </view>
      <text>å…¨é€‰</text>
    </view>

    <view class="total-section">
      <view class="total-label">
        <text>åˆè®¡ï¼š</text>
        <text class="total-price">Â¥{{totalPrice}}</text>
      </view>
      <text class="total-count">å…±{{totalCount}}ä»¶</text>
    </view>

    <view class="checkout-btn {{totalCount > 0 ? '' : 'disabled'}}" bindtap="onCheckout">
      <text>å»ç»“ç®—</text>
    </view>
  </view>
</view>
