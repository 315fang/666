<!--pages/cart/cart.wxml - 购物车-->
<view class="container">
  <!-- 空购物车 -->
  <view class="empty-cart-container {{showEmpty ? 'fade-in' : ''}}" wx:if="{{!loading && cartItems.length === 0}}">
    <!-- 背景装饰 -->
    <view class="empty-bg-decoration">
      <view class="blob blob-1"></view>
      <view class="blob blob-2"></view>
      <view class="blob blob-3"></view>
    </view>

    <view class="empty-cart-content">
      <view class="empty-icon-wrapper">
        <view class="empty-icon-pulse"></view>
        <image class="empty-icon-img" src="/assets/icons/cart.svg" mode="aspectFit"></image>
      </view>
      <text class="empty-title">购物车是空的</text>
      <text class="empty-desc">快去挑选心仪的商品吧</text>
      <navigator url="/pages/index/index" open-type="switchTab" class="btn-go-shopping">
        <text>去逛逛</text>
        <view class="btn-glow"></view>
      </navigator>
    </view>

    <!-- 猜你喜欢 -->
    <view class="recommended-section" wx:if="{{recommendedProducts.length > 0}}">
      <view class="section-header">
        <view class="header-line"></view>
        <text class="header-title">猜你喜欢</text>
        <view class="header-line"></view>
      </view>
      
      <view class="recommended-grid">
        <view class="product-card" 
              wx:for="{{recommendedProducts}}" 
              wx:key="id" 
              bindtap="onRecommendedTap" 
              data-id="{{item.id}}">
          <view class="product-img-box">
            <image src="{{item.firstImage}}" mode="aspectFill"></image>
            <view class="sales-tag" wx:if="{{item.sales_count > 0}}">热销 {{item.sales_count}}</view>
          </view>
          <view class="product-info-box">
            <text class="product-title">{{item.name}}</text>
            <view class="product-price-row">
              <text class="currency">¥</text>
              <text class="price">{{item.retail_price}}</text>
              <view class="add-cart-btn">
                <text>+</text>
              </view>
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 购物车列表 -->
  <view class="cart-list" wx:if="{{cartItems.length > 0}}">
    <view class="cart-item {{item.deleting ? 'slide-out' : ''}} {{item.animateIn ? 'slide-in' : ''}}" 
          wx:for="{{cartItems}}" 
          wx:key="id"
          style="animation-delay: {{index * 80}}ms">
      <!-- 选择框 -->
      <view class="checkbox-wrapper" bindtap="onToggleSelect" data-index="{{index}}">
        <view class="checkbox {{item.selected ? 'checked' : ''}}">
          <text wx:if="{{item.selected}}">✓</text>
        </view>
      </view>

      <!-- 商品图片 -->
      <view class="product-image-wrapper" bindtap="onProductTap" data-item="{{item}}">
        <image class="product-image" 
               src="{{item.firstImage || '/assets/images/placeholder.svg'}}" 
               mode="aspectFill"></image>
      </view>

      <!-- 商品信息 -->
      <view class="product-info">
        <text class="product-name" bindtap="onProductTap" data-item="{{item}}">
          {{item.productName}}
        </text>
        <text class="product-spec" wx:if="{{item.sku && item.sku.spec_value}}">
          {{item.sku.spec_value}}
        </text>
        
        <view class="price-quantity-row">
          <text class="product-price">{{item.price}}</text>
          
          <!-- 数量控制 -->
          <view class="quantity-control">
            <view class="qty-btn {{item.quantity <= 1 ? 'disabled' : ''}}" 
                  bindtap="onQuantityChange" 
                  data-index="{{index}}" 
                  data-type="minus">−</view>
            <view class="qty-num-wrapper">
              <text class="qty-num {{item.quantityAnim ? 'num-pop' : ''}}">{{item.quantity}}</text>
            </view>
            <view class="qty-btn" 
                  bindtap="onQuantityChange" 
                  data-index="{{index}}" 
                  data-type="plus">+</view>
          </view>
        </view>
      </view>

      <!-- 删除按钮 -->
      <view class="delete-btn" bindtap="onDelete" data-index="{{index}}">
        <image src="/assets/icons/trash.svg" style="width:36rpx;height:36rpx;" mode="aspectFit"></image>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 底部结算栏 -->
  <view class="checkout-bar {{cartItems.length > 0 ? 'bar-slide-up' : ''}}" wx:if="{{cartItems.length > 0}}">
    <view class="select-all" bindtap="onToggleSelectAll">
      <view class="checkbox {{selectAll ? 'checked' : ''}}">
        <text wx:if="{{selectAll}}">✓</text>
      </view>
      <text>全选</text>
    </view>

    <view class="total-section">
      <view class="total-label">
        <text>合计：</text>
        <view class="price-wrapper">
          <text class="total-price {{priceAnim ? 'price-flip' : ''}}">{{totalPrice}}</text>
        </view>
      </view>
      <text class="total-count {{countAnim ? 'count-bounce' : ''}}">共{{totalCount}}件</text>
    </view>

    <view class="checkout-btn {{totalCount > 0 ? '' : 'disabled'}}" bindtap="onCheckout">
      <text>去结算</text>
      <view class="btn-shine"></view>
    </view>
  </view>
</view>
