<!--pages/logistics/tracking.wxml - ç‰©æµè·Ÿè¸ªé¡µé¢-->
<view class="container">
  <view class="nav-bar" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-back" bindtap="onBack">
      <image class="nav-icon" src="/assets/icons/arrow-left.svg" mode="aspectFit"/>
    </view>
    <text class="nav-title">ç‰©æµè·Ÿè¸ª</text>
    <view class="refresh-btn" bindtap="onRefresh">åˆ·æ–°</view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading-wrap" wx:if="{{loading}}">
    <view class="loading-spinner"/>
    <text class="loading-text">æŸ¥è¯¢ç‰©æµä¸­...</text>
  </view>

  <!-- é”™è¯¯æç¤º -->
  <view class="error-wrap" wx:elif="{{error}}">
    <image src="/assets/icons/package.svg" class="error-icon" mode="aspectFit"/>
    <text class="error-text">{{error}}</text>
    <view class="retry-btn" bindtap="onRefresh">é‡æ–°æŸ¥è¯¢</view>
  </view>

  <!-- ç‰©æµä¿¡æ¯ -->
  <view wx:elif="{{info}}">
    <!-- çŠ¶æ€å¤´éƒ¨ -->
    <view class="status-header {{info.status}}">
      <view class="status-icon-wrap">
        <image class="status-icon" src="/assets/icons/package.svg" mode="aspectFit"/>
      </view>
      <view class="status-info">
        <text class="status-text">{{info.status_text}}</text>
        <text class="tracking-no">è¿å•ï¼š{{info.tracking_no}}</text>
        <text class="company">æ‰¿è¿ï¼š{{info.company}}</text>
      </view>
      <view class="cache-badge" wx:if="{{info.fromCache}}">ç¼“å­˜</view>
    </view>

    <!-- è®¢å•ä¿¡æ¯ -->
    <view class="order-bar" wx:if="{{info.order_no}}">
      <text class="order-bar-text">è®¢å•å·ï¼š{{info.order_no}}</text>
    </view>

    <!-- ç‰©æµè½¨è¿¹æ—¶é—´çº¿ -->
    <view class="timeline">
      <view class="trace-item {{index === 0 ? 'active' : ''}}" wx:for="{{info.traces}}" wx:key="*this">
        <view class="trace-left">
          <view class="trace-dot {{index === 0 ? 'active' : ''}}"/>
          <view class="trace-line" wx:if="{{index < info.traces.length - 1}}"/>
        </view>
        <view class="trace-right">
          <text class="trace-time">{{item.time}}</text>
          <text class="trace-desc">{{item.desc}}</text>
          <text class="trace-loc" wx:if="{{item.location}}">ğŸ“ {{item.location}}</text>
        </view>
      </view>

      <!-- ç©ºè½¨è¿¹ -->
      <view class="empty-trace" wx:if="{{!info.traces.length}}">
        <text>æš‚æ— è·Ÿè¸ªä¿¡æ¯ï¼Œè¯·ç¨åæŸ¥è¯¢</text>
      </view>
    </view>

    <!-- æŸ¥è¯¢æ—¶é—´ -->
    <view class="query-time">
      <text>æŸ¥è¯¢æ—¶é—´ï¼š{{info.query_time}}</text>
      <text wx:if="{{info.is_mock}}" class="mock-badge">æµ‹è¯•æ•°æ®</text>
    </view>
  </view>
</view>
