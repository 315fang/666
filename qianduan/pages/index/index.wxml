<!--pages/index/index.wxml - 首页重构：固定海报 + 真实组件卡片-->
<view class="container">

  <!-- 气泡通告浮层 -->
  <view class="bubble-float {{bubbleVisible ? 'bubble-show' : 'bubble-hide'}}">
    <view class="bubble-inner">
      <view class="bubble-dot"></view>
      <text class="bubble-text">{{currentBubble}}</text>
    </view>
  </view>

  <!-- 1. 固定海报区 -->
  <view class="poster-section">
    <image
      class="poster-img"
      src="{{homeConfigs.home_poster_url || '/assets/images/default-poster.svg'}}"
      mode="aspectFill"
      wx:if="{{homeConfigs.home_poster_url}}"
    ></image>
    <view class="poster-fallback" wx:else>
      <view class="poster-deco-circle p1"></view>
      <view class="poster-deco-circle p2"></view>
      <view class="poster-content">
        <text class="poster-brand">臻 选</text>
        <text class="poster-slogan">遇见品质，遇见美好</text>
      </view>
    </view>
  </view>

  <!-- 2. 会员等级卡 -->
  <view class="member-card" bindtap="onMemberCardTap">
    <view class="member-left">
      <view class="member-level-badge">
        <image class="level-icon" src="/assets/icons/crown.svg" mode="aspectFit"></image>
        <text class="level-name">{{userInfo.role_name || '普通会员'}}</text>
      </view>
      <text class="member-name">{{truncatedName || '点击登录'}}</text>
    </view>
    <view class="member-right">
      <view class="growth-info">
        <view class="growth-row">
          <text class="growth-label">成长值</text>
          <text class="growth-value">{{growthValue || 0}}</text>
          <text class="growth-target"> / {{nextLevelThreshold || '--'}}</text>
        </view>
        <view class="growth-bar-bg">
          <view class="growth-bar-fill" style="width: {{growthPercent || 0}}%"></view>
        </view>
      </view>
      <image class="member-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 3. 积分卡 -->
  <view class="points-row">
    <view class="points-card" bindtap="onPointsTap">
      <view class="points-left">
        <image class="points-icon" src="/assets/icons/gift.svg" mode="aspectFit"></image>
        <view class="points-text">
          <text class="points-num">{{pointBalance || 0}}</text>
          <text class="points-label">我的积分</text>
        </view>
      </view>
      <view class="points-actions">
        <view class="pts-btn sign-btn" bindtap="onSignInTap" catchtap="catchtap">
          {{todaySigned ? '已签到' : '签  到'}}
        </view>
        <view class="pts-btn exchange-btn" bindtap="onExchangeTap" catchtap="catchtap">兑  换</view>
      </view>
    </view>
  </view>

  <!-- 4. 活动预告卡 -->
  <view class="activity-preview-card" bindtap="onActivityTap">
    <view class="ap-left">
      <view class="ap-icon-wrap">
        <image class="ap-icon" src="/assets/icons/hot.svg" mode="aspectFit"></image>
      </view>
      <view class="ap-text">
        <text class="ap-title">{{latestActivity.name || '活动即将开启'}}</text>
        <text class="ap-desc">{{latestActivity.desc || '拼团·砍价·抽奖 敬请期待'}}</text>
      </view>
    </view>
    <view class="ap-right">
      <text class="ap-cta">查看</text>
      <image class="ap-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 5. 特色活动卡片 -->
  <view class="feature-section" wx:if="{{featureCards.length > 0}}">
    <view class="feature-header">
      <view class="feature-title-wrap">
        <view class="feature-title-bar"></view>
        <text class="feature-title">我们的特色</text>
      </view>
      <text class="feature-subtitle">Our Features</text>
    </view>
    <scroll-view class="feature-scroll" scroll-x="{{true}}" enhanced="{{true}}" show-scrollbar="{{false}}">
      <view class="feature-list">
        <view
          class="feature-card"
          wx:for="{{featureCards}}"
          wx:key="id"
          bindtap="onFeatureCardTap"
          data-item="{{item}}"
          style="background: {{item.bg_gradient || 'linear-gradient(145deg,#1a1a2e,#16213e)'}}"
        >
          <view class="fc-deco-circle fc-circle-1"></view>
          <view class="fc-deco-circle fc-circle-2"></view>
          <view class="fc-icon-wrap">
            <image class="fc-icon" src="{{item.icon_url}}" mode="aspectFit" wx:if="{{item.icon_url}}"></image>
            <text class="fc-icon-text" wx:else>{{item.icon_emoji || '⭐'}}</text>
          </view>
          <view class="fc-content">
            <text class="fc-name">{{item.name}}</text>
            <text class="fc-desc">{{item.description}}</text>
          </view>
          <view class="fc-tag" wx:if="{{item.tag}}">
            <text class="fc-tag-text">{{item.tag}}</text>
          </view>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 6. 使用指南卡 -->
  <view class="banner-card-section" bindtap="onGuideTap">
    <view class="banner-card-header">
      <text class="banner-card-title">小程序使用指南</text>
      <view class="banner-card-more">
        <text>点击查看</text>
        <image class="icon-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>
    <view class="banner-card-body red-theme" style="{{homeConfigs.guide_bg ? 'background-image: url(' + homeConfigs.guide_bg + '); background-size: cover; background-position: center;' : ''}}">
      <view class="banner-card-content">
        <text class="card-big-text">GET指南</text>
        <text class="card-sub-text">最新功能操作攻略</text>
      </view>
    </view>
  </view>

  <!-- 7. 共创信息卡 -->
  <view class="banner-card-section" bindtap="onCoCreationTap">
    <view class="banner-card-header">
      <text class="banner-card-title">共创信息</text>
      <view class="banner-card-more">
        <text>获取更多不定期的共创机会</text>
        <image class="icon-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>
    <view class="banner-card-body dark-theme" style="{{homeConfigs.cocreation_bg ? 'background-image: url(' + homeConfigs.cocreation_bg + '); background-size: cover; background-position: center;' : ''}}">
      <view class="banner-card-content">
        <text class="card-big-text">天马乘风 共创未来</text>
        <text class="card-sub-text">携手同行，共建美好未来</text>
      </view>
    </view>
  </view>

  <!-- 品牌动画 -->
  <brand-animation id="brandAnimation"></brand-animation>

</view>
