<!--pages/index/index.wxml-->
<view class="container">
  <!-- 1. Banner Section (Keep existing but simplified) -->
  <view class="banner-section">
    <swiper class="banner-swiper" indicator-dots="{{true}}" autoplay="{{true}}" circular="{{true}}" indicator-color="rgba(255,255,255,0.4)" indicator-active-color="#ffffff">
      <swiper-item wx:for="{{banners}}" wx:key="id" bindtap="onBannerTap" data-item="{{item}}">
        <view class="banner-item">
          <image src="{{item.image_url}}" mode="aspectFill" class="banner-img"></image>
          <!-- Text overlay removed as requested "leave empty" -->
        </view>
      </swiper-item>
    </swiper>
  </view>

  <!-- 2. 数据看板 Dashboard (新增) -->
  <view class="dashboard-card" wx:if="{{isLoggedIn}}">
    <!-- 1. 主KPI卡片 -->
    <view class="kpi-primary-card">
      <view class="kpi-header">
        <text class="kpi-title">本月收益</text>
        <view class="kpi-period">
          <image class="icon-xs" src="/assets/icons/calendar.svg" mode="aspectFit" />
          <text class="period-text">{{dashboard.currentMonth}}</text>
        </view>
      </view>
      
      <view class="kpi-main">
        <text class="kpi-value">¥{{dashboard.monthlyRevenue}}</text>
        <view class="kpi-badge {{dashboard.growthTrend}}">
          <image class="trend-icon" src="/assets/icons/trending-{{dashboard.growthTrend}}.svg" mode="aspectFit" />
          <text class="trend-text">{{dashboard.revenueGrowth}}%</text>
        </view>
      </view>
      
      <text class="kpi-subtitle">较上月</text>
    </view>
    
    <!-- 2. 次要KPI三栏 -->
    <view class="kpi-secondary-row">
      <view class="kpi-item">
        <view class="kpi-item-icon todayRevenue">
          <image src="/assets/icons/zap.svg" mode="aspectFit" />
        </view>
        <text class="kpi-item-value">¥{{dashboard.todayRevenue}}</text>
        <text class="kpi-item-label">今日收益</text>
      </view>
      
      <view class="kpi-divider"></view>
      
      <view class="kpi-item">
        <view class="kpi-item-icon teamSize">
          <image src="/assets/icons/users.svg" mode="aspectFit" />
        </view>
        <text class="kpi-item-value">{{dashboard.teamSize}}</text>
        <text class="kpi-item-label">团队人数</text>
      </view>
      
      <view class="kpi-divider"></view>
      
      <view class="kpi-item">
        <view class="kpi-item-icon orders">
          <image src="/assets/icons/shopping-bag.svg" mode="aspectFit" />
        </view>
        <text class="kpi-item-value">{{dashboard.monthlyOrders}}</text>
        <text class="kpi-item-label">本月订单</text>
      </view>
    </view>
    
    <!-- 3. 收益趋势图 -->
    <view class="revenue-trend-section">
      <view class="trend-header">
        <text class="trend-title">收益趋势</text>
        <text class="trend-subtitle">最近5天</text>
      </view>
      <view class="trend-chart">
        <view class="bar-container" wx:for="{{dashboard.revenueTrend}}" wx:key="index">
          <view class="bar" style="height: {{item}}%">
            <view class="bar-fill"></view>
          </view>
        </view>
      </view>
    </view>
    
    <!-- 4. 快捷操作 -->
    <view class="quick-actions">
      <view class="action-btn primary" bindtap="onWithdraw">
        <image class="action-icon" src="/assets/icons/dollar-sign.svg" mode="aspectFit" />
        <text>提现</text>
      </view>
      <view class="action-btn secondary" bindtap="onViewDetails">
        <image class="action-icon" src="/assets/icons/bar-chart-2.svg" mode="aspectFit" />
        <text>查看详情</text>
      </view>
    </view>
  </view>

  <!-- 2. Identity Info Panel (仅未登录时显示) -->
  <view class="identity-card" wx:if="{{!isLoggedIn}}">
    <view class="identity-row">
      <!-- Name & Level -->
      <view class="identity-left">
        <view class="identity-name">{{truncatedName || '游客'}}</view>
        <view class="identity-level" wx:if="{{userInfo.role_name}}">{{userInfo.role_name}}</view>
      </view>
      
      <!-- Stats (Commission & Team) -->
      <view class="identity-right">
        <view class="stat-item">
          <image class="stat-icon" src="/assets/icons/dollar-sign.svg" mode="aspectFit"></image>
          <text class="stat-value">{{stats.commission || '0.00'}}</text>
        </view>
        <view class="stat-item">
          <image class="stat-icon" src="/assets/icons/users.svg" mode="aspectFit"></image>
          <text class="stat-value">{{stats.teamCount || '0'}}人</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 3. Main Entrances (Join Us & About Us) -->
  <view class="main-entrances">
    <view class="entrance-card" bindtap="onJoinUsTap">
      <view class="entrance-bg"></view> <!-- Placeholder for image -->
      <view class="entrance-content">
        <text class="entrance-title">加入我们</text>
        <text class="entrance-subtitle">Join Us</text>
      </view>
    </view>
    <view class="entrance-card" bindtap="onAboutUsTap">
      <view class="entrance-bg"></view> <!-- Placeholder for image -->
      <view class="entrance-content">
        <text class="entrance-title">了解我们</text>
        <text class="entrance-subtitle">About Us</text>
      </view>
    </view>
  </view>

  <!-- 4. Secondary Entrances -->
  <view class="secondary-grid">
    <view class="secondary-item" bindtap="onMirrorMeetupTap">
      <view class="secondary-icon-box mirror">
        <!-- Placeholder Icon -->
        <image class="secondary-icon" src="/assets/icons/users.svg" mode="aspectFit"></image>
      </view>
      <text class="secondary-text">镜像见面会</text>
    </view>
    <view class="secondary-item" bindtap="onSalesBootcampTap">
      <view class="secondary-icon-box sales">
        <image class="secondary-icon" src="/assets/icons/trending-up.svg" mode="aspectFit"></image>
      </view>
      <text class="secondary-text">销售实战营</text>
    </view>
    <view class="secondary-item" bindtap="onFounderTalkTap">
      <view class="secondary-icon-box talk">
        <image class="secondary-icon" src="/assets/icons/message-circle.svg" mode="aspectFit"></image>
      </view>
      <text class="secondary-text">创始人对谈</text>
    </view>
    <view class="secondary-item" bindtap="onKnowledgePlanetTap">
      <view class="secondary-icon-box planet">
        <image class="secondary-icon" src="/assets/icons/globe.svg" mode="aspectFit"></image>
      </view>
      <text class="secondary-text">知识星球</text>
    </view>
  </view>

  <!-- 5. Mini Program User Guide -->
  <view class="banner-card-section" bindtap="onGuideTap">
    <view class="banner-card-header">
      <text class="banner-card-title">小程序使用指南</text>
      <view class="banner-card-more">
        <text>点击查看</text>
        <image class="icon-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>
    <view class="banner-card-body red-theme">
      <view class="banner-card-content">
        <text class="card-big-text">GET指南</text>
        <text class="card-sub-text">最新功能操作攻略</text>
      </view>
      <!-- Background decoration circles/lines could be CSS -->
    </view>
  </view>

  <!-- 6. Co-creation Info -->
  <view class="banner-card-section" bindtap="onCoCreationTap">
    <view class="banner-card-header">
      <text class="banner-card-title">共创信息</text>
      <view class="banner-card-more">
        <text>获取更多不定期的共创机会</text>
        <image class="icon-arrow" src="/assets/icons/arrow-right.svg" mode="aspectFit"></image>
      </view>
    </view>
    <view class="banner-card-body dark-theme">
      <view class="banner-card-content">
        <text class="card-big-text">天马乘风 共创未来</text>
        <text class="card-sub-text">借一杯岩骨花香，祝你新年骐骥驰骋</text>
      </view>
    </view>
  </view>

</view>
