<!-- pages/order/logistics.wxml -->
<view class="logistics-container">
    <!-- Loading çŠ¶æ€ -->
    <view wx:if="{{loading}}" class="loading-box">
        <view class="loading-icon"></view>
        <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- ä¸»è¦å†…å®¹ -->
    <view wx:else class="content">
        <!-- ç‰©æµçŠ¶æ€å¡ç‰‡ -->
        <view class="status-card">
            <view class="status-header">
                <view class="status-icon {{logisticsStatus}}"></view>
                <view class="status-info">
                    <text class="status-title">
                        {{logisticsStatus === 'delivered' ? 'å·²ç­¾æ”¶' : logisticsStatus === 'problem' ? 'è¿è¾“å¼‚å¸¸' : 'è¿è¾“ä¸­'}}
                    </text>
                    <text class="status-desc" wx:if="{{trackingInfo.length > 0}}">
                        {{trackingInfo[0].status || trackingInfo[0].context}}
                    </text>
                    <text class="status-desc" wx:else>{{errorMessage || 'æš‚æ— ç‰©æµè½¨è¿¹'}}</text>
                </view>
            </view>

            <!-- å•†å“ä¿¡æ¯ -->
            <view wx:if="{{product}}" class="product-info">
                <image class="product-image" src="{{product.image}}" mode="aspectFill"></image>
                <view class="product-details">
                    <text class="product-name">{{product.name}}</text>
                    <text class="product-quantity">x{{product.quantity}}</text>
                </view>
            </view>

            <!-- ç‰©æµå•å· -->
            <view class="tracking-info">
                <view class="tracking-row">
                    <text class="tracking-label">ç‰©æµå…¬å¸:</text>
                    <text class="tracking-value">{{courierCompany}}</text>
                </view>
                <view class="tracking-row">
                    <text class="tracking-label">ç‰©æµå•å·:</text>
                    <text class="tracking-value">{{trackingNumber || 'æš‚æ— '}}</text>
                    <text class="copy-btn" wx:if="{{trackingNumber}}" bindtap="copyTrackingNumber">å¤åˆ¶</text>
                </view>
            </view>
        </view>

        <!-- ç‰©æµè½¨è¿¹ -->
        <view class="tracking-timeline" wx:if="{{trackingInfo.length > 0}}">
            <view class="timeline-title">ç‰©æµè½¨è¿¹</view>
            <view class="timeline-list">
                <view class="timeline-item {{index === 0 ? 'active' : ''}}" wx:for="{{trackingInfo}}" wx:key="index">
                    <view class="timeline-dot"></view>
                    <view class="timeline-content">
                        <view class="timeline-status">{{item.status || item.context}}</view>
                        <view class="timeline-time">{{item.time || item.ftime}}</view>
                    </view>
                </view>
            </view>
        </view>

        <!-- æ— ç‰©æµä¿¡æ¯æç¤º -->
        <view class="empty-state" wx:if="{{error && trackingInfo.length === 0}}">
            <image class="empty-icon" src="/assets/images/empty-logistics.png" mode="aspectFit"></image>
            <text class="empty-text">{{errorMessage}}</text>
        </view>

        <!-- æ“ä½œæŒ‰é’® -->
        <view class="action-buttons" wx:if="{{courierPhone}}">
            <button class="action-btn" bindtap="callCourier">
                <text class="btn-icon">ğŸ“</text>
                <text class="btn-text">è”ç³»å¿«é€’</text>
            </button>
        </view>
    </view>
</view>
