<!--pages/distribution/center.wxml - 分销中心（重新设计版）-->
<view class="container">
  
  <!-- 1. 顶部背景 + 核心资产卡片 -->
  <view class="header-bg">
    <view class="header-content">
      <!-- 用户信息行 -->
      <view class="user-row" bindtap="onProfileTap">
        <image class="avatar" src="{{userInfo.avatar_url || '/assets/images/default-avatar.svg'}}" mode="aspectFill"></image>
        <view class="user-info">
          <text class="nickname">{{userInfo.nickname || '微信用户'}}</text>
          <view class="role-badge">{{userInfo.role_name || '普通用户'}}</view>
        </view>
        <view class="arrow">></view>
      </view>
      
      <!-- 可提现余额 - 核心展示 -->
      <view class="balance-card">
        <view class="balance-label">可提现余额 (元)</view>
        <view class="balance-amount">{{balance || '0.00'}}</view>
        <view class="withdraw-btn" bindtap="onWithdrawTap">
          <text>立即提现</text>
          <view class="arrow-icon">→</view>
        </view>
      </view>
    </view>
  </view>

  <!-- 2. 统计数据栏 -->
  <view class="stats-bar">
    <view class="stat-item" bindtap="onCommissionLogsTap">
      <view class="stat-value">¥{{stats.totalEarnings || '0.00'}}</view>
      <view class="stat-label">累计收益</view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item">
      <view class="stat-value">¥{{stats.frozenAmount || '0.00'}}</view>
      <view class="stat-label">待结算</view>
    </view>
    <view class="stat-divider"></view>
    <view class="stat-item" bindtap="onTeamTap">
      <view class="stat-value">{{team.totalCount || 0}}<text class="unit">人</text></view>
      <view class="stat-label">我的团队</view>
    </view>
  </view>

  <!-- 3. 邀请好友区域 -->
  <view class="invite-card">
    <view class="invite-header">
      <text class="invite-title">邀请好友加入团队</text>
      <text class="invite-subtitle">分享邀请问卷，好友填写后自动加入团队</text>
    </view>
    <button class="share-btn-full" open-type="share">
      <text>分享邀请问卷</text>
    </button>
    <view class="invite-detail-btn" bindtap="onInviteTap">
      <text>查看邀请详情 ›</text>
    </view>
  </view>

  <!-- 4. 功能入口列表 -->
  <view class="menu-section">
    <view class="menu-item" bindtap="onCommissionLogsTap">
      <view class="menu-left">
        <view class="menu-icon commission">
          <image class="icon-img" src="/assets/icons/dollar-sign.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">佣金明细</text>
      </view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="onOrderTap">
      <view class="menu-left">
        <view class="menu-icon order">
          <image class="icon-img" src="/assets/icons/shopping-bag.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">分销订单</text>
      </view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="onTeamTap">
      <view class="menu-left">
        <view class="menu-icon team">
          <image class="icon-img" src="/assets/icons/users.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">我的团队</text>
      </view>
      <view class="menu-arrow">></view>
    </view>
    <view class="menu-item" bindtap="onShowShareModal">
      <view class="menu-left">
        <view class="menu-icon share">
          <image class="icon-img" src="/assets/icons/share.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">推广海报</text>
      </view>
      <view class="menu-arrow">></view>
    </view>
  </view>

  <!-- 5. 代理商专区 (仅代理可见) -->
  <view class="agent-section" wx:if="{{isAgent}}">
    <view class="section-title">
      <view class="title-left">
        <view class="title-dot"></view>
        <text>代理商工作台</text>
      </view>
      <view class="agent-badge">专属</view>
    </view>
    <view class="agent-grid">
      <view class="agent-item highlight" bindtap="goWorkbench">
        <view class="item-icon">
          <image src="/assets/icons/truck.svg" mode="aspectFit"/>
        </view>
        <view class="item-content">
          <text class="item-title">发货管理</text>
          <text class="item-desc">处理订单、发货</text>
        </view>
        <view class="item-badge" wx:if="{{agentPending > 0}}">{{agentPending}}</view>
      </view>
      <view class="agent-item" bindtap="goRestock">
        <view class="item-icon">
          <image src="/assets/icons/package.svg" mode="aspectFit"/>
        </view>
        <view class="item-content">
          <text class="item-title">采购入仓</text>
          <text class="item-desc">补货进货</text>
        </view>
      </view>
      <view class="agent-item" bindtap="goStockLogs">
        <view class="item-icon">
          <image src="/assets/icons/list.svg" mode="aspectFit"/>
        </view>
        <view class="item-content">
          <text class="item-title">库存明细</text>
          <text class="item-desc">查看库存</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 6. 规则说明 -->
  <view class="rules-section" bindtap="goRules">
    <image class="rules-icon" src="/assets/icons/info.svg" mode="aspectFit"/>
    <text class="rules-text">分销规则说明</text>
    <view class="arrow">></view>
  </view>

  <!-- 分享弹窗 -->
  <view class="share-modal {{showShareModal ? 'show' : ''}}">
    <view class="mask" bindtap="hideShareModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>分享邀请问卷</text>
        <view class="close" bindtap="hideShareModal">×</view>
      </view>
      <view class="qr-section">
        <text class="qr-tip">点击下方按钮，将邀请问卷分享给好友</text>
      </view>
      <view class="share-actions">
        <button class="action-btn primary" open-type="share">
          <image class="btn-icon-img" src="/assets/icons/message.svg" mode="aspectFit"/>
          <text>发给微信好友</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 提现弹窗 -->
  <view class="withdraw-popup {{showWithdraw ? 'show' : ''}}">
    <view class="mask" bindtap="hideWithdraw"></view>
    <view class="popup-content">
      <view class="popup-title">申请提现</view>
      <view class="popup-balance">当前可提现余额：¥{{balance}}</view>
      <input class="popup-input" type="digit" placeholder="请输入提现金额" bindinput="onWithdrawInput" value="{{withdrawAmount}}" />
      <button class="popup-btn" bindtap="confirmWithdraw">确认提现</button>
    </view>
  </view>
  <!-- 品牌动画（提现成功等） -->
  <brand-animation id="brandAnimation"></brand-animation>
</view>
