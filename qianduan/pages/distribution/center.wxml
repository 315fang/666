<!--pages/distribution/center.wxml - 分佣中心（精简优化版）-->
<view class="container">
  
  <!-- 1. 顶部资产卡片 -->
  <view class="assets-card">
    <view class="user-brief" bindtap="onProfileTap">
      <image class="avatar" src="{{userInfo.avatar_url || '/assets/images/default-avatar.svg'}}" mode="aspectFill"></image>
      <view class="info">
        <text class="nickname">{{userInfo.nickname || '微信用户'}}</text>
        <view class="role-tag">{{userInfo.role_name || '普通用户'}}</view>
      </view>
    </view>
    
    <view class="balance-section">
      <view class="balance-main">
        <text class="label">可提现余额 (元)</text>
        <text class="amount">{{balance || '0.00'}}</text>
      </view>
      <view class="withdraw-btn" bindtap="onWithdrawTap">提现</view>
    </view>

    <view class="stats-grid">
      <view class="stat-item">
        <text class="stat-value">¥{{stats.totalEarnings || '0.00'}}</text>
        <text class="stat-label">累计收益</text>
      </view>
      <view class="stat-item">
        <text class="stat-value">¥{{stats.frozenAmount || '0.00'}}</text>
        <text class="stat-label">待结算</text>
      </view>
      <view class="stat-item" bindtap="onTeamTap">
        <text class="stat-value">{{team.totalCount || 0}}</text>
        <text class="stat-label">我的团队</text>
      </view>
    </view>
  </view>

  <!-- 2. 核心功能入口 -->
  <view class="function-section">
    <view class="section-title">分销管理</view>
    <view class="grid-menu">
      <view class="menu-item" bindtap="onCommissionLogsTap">
        <view class="menu-icon commission">
          <image class="icon-img" src="/assets/icons/dollar-sign.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">佣金明细</text>
      </view>
      <view class="menu-item" bindtap="onOrderTap">
        <view class="menu-icon order">
          <image class="icon-img" src="/assets/icons/clipboard.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">分销订单</text>
      </view>
      <view class="menu-item" bindtap="onTeamTap">
        <view class="menu-icon team">
          <image class="icon-img" src="/assets/icons/users.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">我的团队</text>
      </view>
      <view class="menu-item" bindtap="onShowShareModal">
        <view class="menu-icon share">
          <image class="icon-img" src="/assets/icons/share.svg" mode="aspectFit"/>
        </view>
        <text class="menu-name">推广分享</text>
      </view>
    </view>
  </view>

  <!-- 3. 邀请码区域 -->
  <view class="invite-section">
    <view class="invite-box">
      <view class="invite-left">
        <text class="label">我的邀请码</text>
        <text class="code">{{inviteCode || '---'}}</text>
      </view>
      <view class="invite-right">
        <view class="copy-btn" bindtap="onCopyInviteCode">复制</view>
        <button class="share-btn" open-type="share">微信分享</button>
      </view>
    </view>
    <view class="bind-parent-tip" wx:if="{{!hasParent}}" bindtap="onBindInviteTap">
      <text>你有邀请码？点击这里绑定上级团队 ＞</text>
    </view>
  </view>

  <!-- 4. 代理商专区 (仅代理可见) -->
  <view class="agent-section" wx:if="{{isAgent}}">
    <view class="section-header">
      <view class="title-with-icon">
        <image class="title-icon" src="/assets/icons/bar-chart.svg" mode="aspectFit"/>
        <text class="title">代理商工作台</text>
      </view>
      <text class="badge">代理商专属</text>
    </view>
    <view class="agent-grid">
      <view class="agent-card main" bindtap="goWorkbench">
        <text class="card-title">发货工作台</text>
        <text class="card-desc">处理订单、填写物流</text>
        <view class="card-badge" wx:if="{{agentPending > 0}}">{{agentPending}}</view>
      </view>
      <view class="agent-sub-grid">
        <view class="agent-card" bindtap="goRestock">
          <text class="card-title">采购入仓</text>
        </view>
        <view class="agent-card" bindtap="goStockLogs">
          <text class="card-title">库存明细</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 5. 提现说明 -->
  <view class="footer-tips">
    <view class="tip-title">规则说明</view>
    <view class="tip-content">
      <text>{{rulesSummary}}</text>
      <text class="rules-link" bindtap="goRules">查看完整规则说明 ＞</text>
    </view>
  </view>

  <!-- 分享弹窗 -->
  <view class="share-modal {{showShareModal ? 'show' : ''}}">
    <view class="mask" bindtap="hideShareModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text>推广分享</text>
        <view class="close" bindtap="hideShareModal">×</view>
      </view>
      <view class="qr-section">
        <image class="qr-image" src="{{qrCodeUrl || '/assets/images/placeholder.svg'}}" mode="aspectFit"></image>
        <text class="qr-tip">保存二维码，让好友扫码加入</text>
        <view class="save-btn" bindtap="onSaveQRCode">保存二维码到相册</view>
      </view>
      <view class="share-actions">
        <button class="action-btn primary" open-type="share">
          <image class="btn-icon-img" src="/assets/icons/message.svg" mode="aspectFit"/>
          <text>发给微信好友</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 提现弹窗 (复用) -->
  <view class="withdraw-popup {{showWithdraw ? 'show' : ''}}">
    <view class="mask" bindtap="hideWithdraw"></view>
    <view class="popup-content">
      <view class="popup-title">申请提现</view>
      <view class="popup-balance">当前可提现余额：¥{{balance}}</view>
      <input class="popup-input" type="digit" placeholder="请输入提现金额" bindinput="onWithdrawInput" value="{{withdrawAmount}}" />
      <button class="popup-btn" bindtap="confirmWithdraw">确认提现</button>
    </view>
  </view>

  <!-- 绑定邀请码弹窗 (复用) -->
  <view class="withdraw-popup {{showBindInvite ? 'show' : ''}}">
    <view class="mask" bindtap="hideBindInvite"></view>
    <view class="popup-content">
      <view class="popup-title">填写邀请码</view>
      <view class="popup-balance">加入推荐人团队，绑定后不可更改</view>
      <input class="popup-input" type="text" placeholder="请输入6位邀请码" bindinput="onBindInviteInput" value="{{bindInviteCode}}" maxlength="6" />
      <button class="popup-btn" bindtap="confirmBindInvite">确认绑定</button>
    </view>
  </view>

</view>
