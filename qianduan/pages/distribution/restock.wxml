<!--pages/distribution/restock.wxml - 工厂采购入仓-->
<view class="container">
  <!-- 当前库存提示 -->
  <view class="stock-banner">
    <text class="stock-banner-label">当前云仓库存</text>
    <text class="stock-banner-value">{{currentStock}} 件</text>
  </view>

  <!-- 商品列表 -->
  <view class="section-title">选择进货商品</view>
  <view class="product-list">
    <view class="product-card {{selectedProduct && selectedProduct.id === item.id ? 'selected' : ''}}"
          wx:for="{{products}}" wx:key="id"
          data-product="{{item}}" bindtap="onSelectProduct">
      <image class="product-img" src="{{item.image}}" mode="aspectFill"></image>
      <view class="product-info">
        <text class="product-name">{{item.name}}</text>
        <view class="product-prices">
          <text class="agent-price">工厂价 ¥{{item.agent_price}}</text>
          <text class="retail-price">零售价 ¥{{item.retail_price}}</text>
        </view>
        <text class="product-stock">平台库存: {{item.stock}}件</text>
      </view>
      <view class="check-mark" wx:if="{{selectedProduct && selectedProduct.id === item.id}}">✓</view>
    </view>

    <view class="empty" wx:if="{{products.length === 0}}">
      <text class="empty-text">暂无可进货的商品</text>
    </view>
  </view>

  <!-- 进货数量 -->
  <view class="quantity-card" wx:if="{{selectedProduct}}">
    <view class="quantity-header">
      <text class="quantity-title">{{selectedProduct.name}}</text>
      <text class="quantity-price">工厂价: ¥{{selectedProduct.agent_price}}/件</text>
    </view>
    <view class="quantity-row">
      <text class="quantity-label">进货数量</text>
      <view class="quantity-control">
        <view class="qty-btn" bindtap="onMinus">−</view>
        <input class="qty-input" type="number" value="{{quantity}}" bindinput="onQuantityInput" />
        <view class="qty-btn" bindtap="onPlus">+</view>
      </view>
    </view>
    <!-- 快捷数量 -->
    <view class="quick-qty">
      <view class="quick-btn {{quantity === 10 ? 'active' : ''}}" data-qty="10" bindtap="onQuickQty">10件</view>
      <view class="quick-btn {{quantity === 50 ? 'active' : ''}}" data-qty="50" bindtap="onQuickQty">50件</view>
      <view class="quick-btn {{quantity === 100 ? 'active' : ''}}" data-qty="100" bindtap="onQuickQty">100件</view>
      <view class="quick-btn {{quantity === 200 ? 'active' : ''}}" data-qty="200" bindtap="onQuickQty">200件</view>
    </view>
    <view class="total-row">
      <text class="total-label">进货总额</text>
      <text class="total-amount">¥{{totalAmount}}</text>
    </view>
  </view>

  <!-- 底部操作栏 -->
  <view class="action-bar safe-bottom" wx:if="{{selectedProduct}}">
    <view class="action-summary">
      <text class="summary-qty">共 {{quantity}} 件</text>
      <text class="summary-total">¥{{totalAmount}}</text>
    </view>
    <view class="action-btn" bindtap="onConfirmRestock">确认采购</view>
  </view>
</view>
