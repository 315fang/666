<!--pages/distribution/workbench.wxml - 轻奢风代理商工作台-->
<view class="container">
  <!-- 1. 云仓状态卡片 -->
  <view class="stock-card">
    <!-- 背景装饰 -->
    <view class="card-decoration"></view>
    
    <view class="stock-main">
      <view class="stock-icon-wrap">
        <image class="stock-icon" src="/assets/icons/package.svg" mode="aspectFit"/>
      </view>
      <view class="stock-number">{{workbench.stock_count || 0}}</view>
      <view class="stock-label">云仓库存(件)</view>
    </view>
    
    <view class="stock-stats">
      <view class="stat-item">
        <view class="stat-icon-wrap">
          <image class="stat-icon" src="/assets/icons/truck.svg" mode="aspectFit"/>
        </view>
        <text class="stat-value">{{workbench.pending_ship || 0}}</text>
        <text class="stat-label">待发货</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-icon-wrap">
          <image class="stat-icon" src="/assets/icons/clock.svg" mode="aspectFit"/>
        </view>
        <text class="stat-value">{{workbench.pending_confirm || 0}}</text>
        <text class="stat-label">待确认</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-icon-wrap">
          <image class="stat-icon" src="/assets/icons/check-circle.svg" mode="aspectFit"/>
        </view>
        <text class="stat-value">{{workbench.total_handled || 0}}</text>
        <text class="stat-label">累计发货</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-icon-wrap gold">
          <image class="stat-icon" src="/assets/icons/bar-chart.svg" mode="aspectFit"/>
        </view>
        <text class="stat-value highlight">¥{{workbench.month_profit || '0.00'}}</text>
        <text class="stat-label">本月利润</text>
      </view>
    </view>
    
    <view class="stock-actions">
      <view class="stock-btn primary" bindtap="goRestock">
        <image class="btn-icon" src="/assets/icons/plus.svg" mode="aspectFit"/>
        <text>采购入仓</text>
      </view>
      <view class="stock-btn outline" bindtap="goStockLogs">
        <image class="btn-icon" src="/assets/icons/list.svg" mode="aspectFit"/>
        <text>库存明细</text>
      </view>
    </view>
  </view>

  <!-- 2. 订单筛选 Tab -->
  <view class="tab-container">
    <scroll-view scroll-x scroll-with-animation show-scrollbar="{{false}}" class="tab-scroll-wrapper">
      <view class="tab-scroll">
        <view class="tab-item {{activeStatus === 'all' ? 'active' : ''}}" data-status="all" bindtap="onStatusChange">
          <text class="tab-text">全部</text>
        </view>
        <view class="tab-item {{activeStatus === 'pending' ? 'active' : ''}}" data-status="pending" bindtap="onStatusChange">
          <text class="tab-text">待发货</text>
          <view class="tab-badge" wx:if="{{workbench.pending_ship > 0}}">{{workbench.pending_ship}}</view>
        </view>
        <view class="tab-item {{activeStatus === 'shipping_requested' ? 'active' : ''}}" data-status="shipping_requested" bindtap="onStatusChange">
          <text class="tab-text">待确认</text>
        </view>
        <view class="tab-item {{activeStatus === 'shipped' ? 'active' : ''}}" data-status="shipped" bindtap="onStatusChange">
          <text class="tab-text">已发货</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 3. 订单列表 -->
  <view class="order-list">
    <view class="order-card" wx:for="{{orders}}" wx:key="id">
      <!-- 订单头部 -->
      <view class="order-header">
        <view class="order-no-wrap">
          <image class="order-icon" src="/assets/icons/shopping-bag.svg" mode="aspectFit"/>
          <text class="order-no">{{item.order_no}}</text>
        </view>
        <view class="order-status status-{{item.status}}">
          <view class="status-dot"></view>
          <text>{{item.status === 'paid' ? '待发货' : item.status === 'agent_confirmed' ? '已确认' : item.status === 'shipping_requested' ? '待平台确认' : item.status === 'shipped' ? '已发货' : item.status === 'completed' ? '已完成' : item.status}}</text>
        </view>
      </view>

      <!-- 商品信息 -->
      <view class="order-product">
        <image class="product-img" src="{{item.product.images[0] || ''}}" mode="aspectFill" wx:if="{{item.product && item.product.images}}"/>
        <view class="product-info">
          <text class="product-name">{{item.product.name || '商品'}}</text>
          <view class="product-meta">
            <view class="buyer-info">
              <image class="user-icon" src="/assets/icons/user.svg" mode="aspectFit"/>
              <text>{{item.buyer.nickname || '用户'}}</text>
            </view>
            <text class="quantity">×{{item.quantity}}</text>
          </view>
          <view class="product-price-wrap">
            <text class="price-label">实付</text>
            <text class="product-price">¥{{item.actual_price || item.total_amount}}</text>
          </view>
        </view>
      </view>

      <!-- 收货地址 -->
      <view class="order-address" wx:if="{{item.address_snapshot}}">
        <view class="address-icon-wrap">
          <image class="address-icon" src="/assets/icons/map-pin.svg" mode="aspectFit"/>
        </view>
        <view class="address-content">
          <text class="address-contact">{{item.address_snapshot.receiver_name}} {{item.address_snapshot.phone}}</text>
          <text class="address-text">{{item.address_snapshot.province}}{{item.address_snapshot.city}}{{item.address_snapshot.district}}{{item.address_snapshot.detail}}</text>
        </view>
      </view>

      <!-- 操作区域 -->
      <view class="order-actions" wx:if="{{item.status === 'paid' || item.status === 'agent_confirmed'}}">
        <text style="color: #999; font-size: 24rpx; padding: 20rpx; text-align: right; display: block; width: 100%;">等待平台发货</text>
      </view>
      <view class="order-actions shipped" wx:if="{{item.status === 'shipped' || item.status === 'completed'}}">
        <view class="tracking-wrap">
          <image class="tracking-icon" src="/assets/icons/navigation.svg" mode="aspectFit"/>
          <text class="tracking-info">物流单号: {{item.tracking_no || '暂无'}}</text>
        </view>
      </view>
    </view>

    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{orders.length === 0 && !loading}}">
      <view class="empty-icon-wrap">
        <image class="empty-icon" src="/assets/icons/inbox.svg" mode="aspectFit"/>
      </view>
      <text class="empty-title">暂无订单</text>
      <text class="empty-desc">当前状态下没有订单数据</text>
    </view>

    <!-- 加载中 -->
    <view class="loading-more" wx:if="{{loading}}">
      <view class="loading-spinner"></view>
      <text class="loading-text">加载中...</text>
    </view>
  </view>
</view>