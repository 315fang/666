<!--pages/user/user.wxml-->
<view class="container">
  <!-- 1. Deep Midnight Header -->
  <view class="user-header">
    <view class="user-info-box">
      <!-- Glow Avatar -->
      <view class="avatar-container">
        <view class="avatar-glow"></view>
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar">
          <image class="user-avatar" src="{{userInfo.avatar_url || '/assets/images/default-avatar.svg'}}" mode="aspectFill"></image>
        </button>
        <view class="edit-icon">âœ</view>
      </view>
      <!-- Names & Tags -->
      <view class="user-names">
        <view class="name-text">
          <input type="nickname" class="nickname-input" placeholder="{{hasUserInfo ? (userInfo.nickname || 'å¾®ä¿¡ç”¨æˆ·') : 'ç‚¹å‡»ç™»å½•'}}" bindblur="onNicknameBlur" />
        </view>
        <view class="user-tags" wx:if="{{hasUserInfo}}">
          <view class="tag-pill gold" wx:if="{{userInfo.role !== 'user'}}">
            <text class="icon">ğŸ‘‘</text>
            <text>{{userInfo.role_name}}</text>
          </view>
          <view class="tag-pill blue">
            <text class="icon">ğŸ”—</text>
            <text>åˆ†äº«å®˜</text>
          </view>
        </view>
      </view>
    </view>
    <!-- æ¶ˆæ¯é€šçŸ¥å…¥å£ -->
    <view class="header-notif-btn" bindtap="onNotificationsTap">
      <text class="notif-icon">ğŸ””</text>
      <view class="notif-badge" wx:if="{{notificationsCount > 0}}">{{notificationsCount > 99 ? '99+' : notificationsCount}}</view>
    </view>
    <!-- Background Decoration -->
    <view class="header-bg-decoration"></view>
  </view>

  <!-- 2. Floating Asset Card -->
  <view class="asset-card-wrapper">
    <view class="asset-card">
      <view class="asset-item" bindtap="goCommission">
        <text class="asset-label">å¾…ç»“ç®—</text>
        <text class="asset-value">Â¥{{stats.frozenAmount || '0.00'}}</text>
      </view>
      <view class="divider"></view>
      <view class="asset-item" bindtap="goWallet">
        <text class="asset-label">å¯æç°</text>
        <text class="asset-value highlight">Â¥{{balance || '0.00'}}</text>
      </view>
      <view class="divider"></view>
      <view class="asset-item" bindtap="goTeam">
        <text class="asset-label">å›¢é˜Ÿäººæ•°</text>
        <text class="asset-value">{{teamCount || 0}}</text>
      </view>
    </view>
  </view>

  <!-- 3. Agent Workbench Banner (Texture) -->
  <view class="banner-wrapper" wx:if="{{isAgent}}" bindtap="goWorkbench">
    <view class="agent-banner">
      <view class="banner-overlay"></view>
      <view class="banner-content">
        <view class="banner-left">
          <text class="material-icon highlight">ğŸ“Š</text>
          <view class="banner-texts">
            <text class="banner-title">å·¥å‚å‘è´§å·¥ä½œå°</text>
            <text class="banner-sub">ç®¡ç†åº“å­˜ & å‘è´§</text>
          </view>
        </view>
        <view class="banner-arrow arrow-circle">â†’</view>
      </view>
    </view>
  </view>

  <!-- 4. Order Section -->
  <view class="section-card">
    <view class="card-header" bindtap="onOrderTap" data-type="all">
      <text class="card-title">æˆ‘çš„è®¢å•</text>
      <view class="card-more">
        <text>å…¨éƒ¨</text>
        <text class="arrow">â€º</text>
      </view>
    </view>
    <view class="order-icons">
      <view class="icon-item" bindtap="onOrderTap" data-type="pending">
        <view class="icon-circle">
          <text>ğŸ’³</text>
          <view class="badge" wx:if="{{orderStats.pending > 0}}">{{orderStats.pending}}</view>
        </view>
        <text class="icon-text">å¾…ä»˜æ¬¾</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="paid">
        <view class="icon-circle">
          <text>ğŸ“¦</text>
          <view class="badge" wx:if="{{orderStats.paid > 0}}">{{orderStats.paid}}</view>
        </view>
        <text class="icon-text">å¾…å‘è´§</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="shipped">
        <view class="icon-circle">
          <text>ğŸšš</text>
          <view class="badge" wx:if="{{orderStats.shipped > 0}}">{{orderStats.shipped}}</view>
        </view>
        <text class="icon-text">å¾…æ”¶è´§</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="completed">
        <view class="icon-circle">
          <text>âœ¨</text>
        </view>
        <text class="icon-text">å·²å®Œæˆ</text>
      </view>
      <view class="icon-item" bindtap="onRefundTap">
        <view class="icon-circle">
          <text>ğŸ”„</text>
        </view>
        <text class="icon-text">å”®å</text>
      </view>
    </view>
  </view>

    <!-- 5. My Tools Grid -->
  <view class="section-card mb-safe">
    <view class="card-header">
      <text class="card-title">å¸¸ç”¨å·¥å…·</text>
    </view>
    <view class="tools-grid">
      <!-- åˆ†ä½£ä¸­å¿ƒï¼šæ•´åˆå›¢é˜Ÿã€é’±åŒ…ã€é‚€è¯·ç  -->
      <view class="tool-item" bindtap="goDistributionCenter">
        <text class="tool-icon text-gold">ğŸ’</text>
        <text class="tool-text">åˆ†ä½£ä¸­å¿ƒ</text>
      </view>
      <view class="tool-item" bindtap="goAddress">
        <text class="tool-icon text-green">ğŸ“</text>
        <text class="tool-text">åœ°å€ç®¡ç†</text>
      </view>
      <view class="tool-item" bindtap="goAIChat">
        <text class="tool-icon text-purple">ğŸ¤–</text>
        <text class="tool-text">æ™ºèƒ½åŠ©æ‰‹</text>
      </view>
      <button class="tool-item share-btn" open-type="contact">
        <text class="tool-icon text-pink">ğŸ§</text>
        <text class="tool-text">è”ç³»å®¢æœ</text>
      </button>
      <view class="tool-item" bindtap="onSettingsTap">
        <text class="tool-icon text-gray">âš™ï¸</text>
        <text class="tool-text">è®¾ç½®</text>
      </view>
    </view>
  </view>
  
  <!-- Invite Code Modal -->
  <view class="invite-modal {{showInvite ? 'show' : ''}}" bindtap="hideInvite">
    <view class="modal-content" catchtap="stopP">
      <view class="modal-title">æˆ‘çš„é‚€è¯·ç </view>
      <view class="code-display" bindtap="copyInviteCode">{{inviteCode}}</view>
      <view class="modal-tip">ç‚¹å‡»å¤åˆ¶ï¼Œåˆ†äº«ç»™å¥½å‹</view>
    </view>
  </view>

</view>
