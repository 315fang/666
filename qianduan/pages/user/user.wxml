<!--pages/user/user.wxml-->
<view class="container">
  <!-- 1. Deep Midnight Header -->
  <view class="user-header">
    <view class="user-info-box">
      <!-- Glow Avatar -->
      <view class="avatar-container" bindtap="onEditNickname">
        <view class="avatar-glow"></view>
        <image class="user-avatar" src="{{userInfo.avatar_url || '/assets/images/default-avatar.svg'}}" mode="aspectFill"></image>
        <view class="edit-icon">✎</view>
      </view>
      <!-- Names & Tags -->
      <view class="user-names">
        <view class="name-text" bindtap="onLoginTap">
          {{hasUserInfo ? (userInfo.nickname || '微信用户') : '点击登录'}}
        </view>
        <view class="user-tags" wx:if="{{hasUserInfo}}">
          <view class="tag-pill gold" wx:if="{{userInfo.role !== 'user'}}">
            <text class="icon">👑</text>
            <text>{{userInfo.role_name}}</text>
          </view>
          <view class="tag-pill blue">
            <text class="icon">🔗</text>
            <text>分享官</text>
          </view>
        </view>
      </view>
    </view>
    <!-- Background Decoration -->
    <view class="header-bg-decoration"></view>
  </view>

  <!-- 2. Floating Asset Card -->
  <view class="asset-card-wrapper">
    <view class="asset-card">
      <view class="asset-item" bindtap="goCommission">
        <text class="asset-label">待结算</text>
        <text class="asset-value">¥{{stats.frozenAmount || '0.00'}}</text>
      </view>
      <view class="divider"></view>
      <view class="asset-item" bindtap="goWallet">
        <text class="asset-label">可提现</text>
        <text class="asset-value highlight">¥{{balance || '0.00'}}</text>
      </view>
      <view class="divider"></view>
      <view class="asset-item" bindtap="goTeam">
        <text class="asset-label">团队人数</text>
        <text class="asset-value">{{teamCount || 0}}</text>
      </view>
    </view>
  </view>

  <!-- 2.5 完善资料提示 (如果没有头像) -->
  <view class="tip-card" wx:if="{{userInfo && !userInfo.avatar_url}}" bindtap="onGetUserProfile">
    <view class="tip-icon">✨</view>
    <view class="tip-content">
      <text class="tip-title">完善资料，享受更多权益</text>
      <text class="tip-desc">点击获取微信头像和昵称</text>
    </view>
    <text class="tip-arrow">›</text>
  </view>

  <!-- 3. Agent Workbench Banner (Texture) -->
  <view class="banner-wrapper" wx:if="{{isAgent}}" bindtap="goWorkbench">
    <view class="agent-banner">
      <view class="banner-overlay"></view>
      <view class="banner-content">
        <view class="banner-left">
          <text class="material-icon highlight">📊</text>
          <view class="banner-texts">
            <text class="banner-title">代理商工作台</text>
            <text class="banner-sub">管理库存 & 发货</text>
          </view>
        </view>
        <view class="banner-arrow arrow-circle">→</view>
      </view>
    </view>
  </view>

  <!-- 4. Order Section -->
  <view class="section-card">
    <view class="card-header" bindtap="onOrderTap" data-type="all">
      <text class="card-title">我的订单</text>
      <view class="card-more">
        <text>全部</text>
        <text class="arrow">›</text>
      </view>
    </view>
    <view class="order-icons">
      <view class="icon-item" bindtap="onOrderTap" data-type="pending">
        <view class="icon-circle">
          <text>💳</text>
          <view class="badge" wx:if="{{orderStats.pending > 0}}">{{orderStats.pending}}</view>
        </view>
        <text class="icon-text">待付款</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="paid">
        <view class="icon-circle">
          <text>📦</text>
          <view class="badge" wx:if="{{orderStats.paid > 0}}">{{orderStats.paid}}</view>
        </view>
        <text class="icon-text">待发货</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="shipped">
        <view class="icon-circle">
          <text>🚚</text>
          <view class="badge" wx:if="{{orderStats.shipped > 0}}">{{orderStats.shipped}}</view>
        </view>
        <text class="icon-text">待收货</text>
      </view>
      <view class="icon-item" bindtap="onOrderTap" data-type="completed">
        <view class="icon-circle">
          <text>✨</text>
        </view>
        <text class="icon-text">已完成</text>
      </view>
      <view class="icon-item" bindtap="onRefundTap">
        <view class="icon-circle">
          <text>🔄</text>
        </view>
        <text class="icon-text">售后</text>
      </view>
    </view>
  </view>

  <!-- 5. My Tools Grid -->
  <view class="section-card mb-safe">
    <view class="card-header">
      <text class="card-title">常用工具</text>
    </view>
    <view class="tools-grid">
      <view class="tool-item" bindtap="goTeam">
        <text class="tool-icon text-blue">👥</text>
        <text class="tool-text">我的团队</text>
      </view>
      <view class="tool-item" bindtap="goWallet">
        <text class="tool-icon text-orange">💰</text>
        <text class="tool-text">我的钱包</text>
      </view>
      <view class="tool-item" bindtap="goAddress">
        <text class="tool-icon text-green">📍</text>
        <text class="tool-text">地址管理</text>
      </view>
      <view class="tool-item" bindtap="onShowInvite">
        <text class="tool-icon text-purple">🎁</text>
        <text class="tool-text">邀请好友</text>
      </view>
      <button class="tool-item share-btn" open-type="share">
        <text class="tool-icon text-pink">📤</text>
        <text class="tool-text">分享赚钱</text>
      </button>
      <button class="tool-item share-btn" open-type="contact">
        <text class="tool-icon text-teal">🎧</text>
        <text class="tool-text">联系客服</text>
      </button>
      <view class="tool-item" bindtap="onSettingsTap">
        <text class="tool-icon text-gray">⚙️</text>
        <text class="tool-text">设置</text>
      </view>
    </view>
  </view>

  <!-- Invite Code Modal (Enhanced) -->
  <view class="invite-modal {{showInvite ? 'show' : ''}}" bindtap="hideInvite">
    <view class="modal-content" catchtap="stopP">
      <view class="modal-title">邀请好友赚佣金</view>
      <view class="code-display" bindtap="copyInviteCode">
        <text class="code-label">我的邀请码</text>
        <text class="code-value">{{inviteCode}}</text>
        <text class="code-copy-hint">点击复制</text>
      </view>
      <view class="share-actions">
        <button class="share-btn-primary" open-type="share">
          <text class="btn-icon">📤</text>
          <text>分享给微信好友</text>
        </button>
        <button class="share-btn-secondary" bindtap="onCopyShareLink">
          <text class="btn-icon">🔗</text>
          <text>复制分享链接</text>
        </button>
      </view>
      <view class="modal-tip">
        <text>💡 好友通过你的邀请注册，你将获得佣金奖励</text>
      </view>
    </view>
  </view>

</view>
