<!--pages/ai/chat.wxml-->
<view class="container">
  <scroll-view class="chat-list" scroll-y scroll-into-view="{{toView}}" scroll-with-animation enable-flex>
    <view class="welcome-tip" wx:if="{{messages.length === 0}}">
      <text class="tip-title">你好！我是您的智能助手</text>
      <text class="tip-sub">我可以帮您解答订单、商品、售后等问题，请随时提问。</text>
    </view>

    <view wx:for="{{messages}}" wx:key="index" id="msg-{{index}}" class="message-item {{item.role === 'user' ? 'user' : 'ai'}}">
      <view class="avatar-box" wx:if="{{item.role === 'ai'}}">
        <view class="avatar ai">🤖</view>
      </view>
      <view class="content">
        <text user-select>{{item.content}}</text>
      </view>
      <view class="avatar-box" wx:if="{{item.role === 'user'}}">
        <image class="avatar" src="{{userInfo.avatar_url || '/assets/icons/user.png'}}" mode="aspectFill"></image>
      </view>
    </view>

    <view class="loading-item" wx:if="{{loading}}">
      <view class="avatar-box">
        <view class="avatar ai">🤖</view>
      </view>
      <view class="loading-dots">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
    </view>
    
    <!-- Padding for bottom input -->
    <view style="height: 120rpx;"></view>
  </scroll-view>

  <view class="input-area">
    <input class="input" type="text" value="{{inputValue}}" bindinput="onInput" bindconfirm="onSend" placeholder="请输入您的问题..." confirm-type="send" cursor-spacing="20" />
    <button class="send-btn {{!inputValue.trim() ? 'disabled' : ''}}" bindtap="onSend">发送</button>
  </view>
</view>
