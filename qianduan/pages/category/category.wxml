<!--pages/category/category.wxml - åˆ†ç±»é¡µé¢-->
<view class="container">
  <!-- æœç´¢æ  -->
  <view class="search-header">
    <view class="search-box" bindtap="onSearchTap">
      <text class="search-icon">ğŸ”</text>
      <text class="search-text">æœç´¢å•†å“</text>
    </view>
  </view>

  <view class="main-content">
    <!-- å·¦ä¾§åˆ†ç±»åˆ—è¡¨ -->
    <scroll-view class="category-sidebar" scroll-y>
      <view class="category-nav-item {{currentCategory === '' ? 'active' : ''}}"
            bindtap="onCategoryChange" data-id="">
        <text>å…¨éƒ¨å•†å“</text>
      </view>
      <view class="category-nav-item {{currentCategory === item.id ? 'active' : ''}}"
            wx:for="{{categories}}" wx:key="id"
            bindtap="onCategoryChange" data-id="{{item.id}}">
        <text>{{item.name}}</text>
      </view>
    </scroll-view>

    <!-- å³ä¾§å•†å“åˆ—è¡¨ -->
    <scroll-view class="product-area" scroll-y bindscrolltolower="onLoadMore">
      <!-- æ’åºç­›é€‰ -->
      <view class="filter-bar">
        <view class="filter-item {{sortBy === 'default' ? 'active' : ''}}" 
              bindtap="onSort" data-sort="default">
          <text>ç»¼åˆ</text>
        </view>
        <view class="filter-item {{sortBy === 'sales' ? 'active' : ''}}" 
              bindtap="onSort" data-sort="sales">
          <text>é”€é‡</text>
        </view>
        <view class="filter-item {{sortBy === 'price' ? 'active' : ''}}" 
              bindtap="onSort" data-sort="price">
          <text>ä»·æ ¼</text>
          <text class="sort-arrow">{{sortOrder === 'asc' ? 'â†‘' : 'â†“'}}</text>
        </view>
      </view>

      <!-- å•†å“ç½‘æ ¼ -->
      <view class="product-list">
        <view class="product-item" 
              wx:for="{{products}}" wx:key="id"
              bindtap="onProductTap" data-item="{{item}}">
          <view class="product-image-wrapper">
            <image class="product-image" 
                   src="{{item.images[0] || '/assets/images/placeholder.png'}}" 
                   mode="aspectFill"></image>
            <view class="hot-tag" wx:if="{{item.is_hot}}">çƒ­</view>
          </view>
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <view class="product-price-row">
              <text class="product-price">{{item.retail_price}}</text>
              <text class="product-sales">å·²å”®{{item.sales_count || 0}}</text>
            </view>
            <view class="quick-add" catchtap="onQuickAdd" data-item="{{item}}">
              <text>+</text>
            </view>
          </view>
        </view>
      </view>

      <!-- åŠ è½½æ›´å¤š -->
      <view class="load-more" wx:if="{{products.length > 0}}">
        <text wx:if="{{hasMore}}">ä¸Šæ‹‰åŠ è½½æ›´å¤š</text>
        <text wx:else>æ²¡æœ‰æ›´å¤šäº†</text>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty" wx:if="{{!loading && products.length === 0}}">
        <text class="empty-icon">ğŸ“¦</text>
        <text class="empty-text">æš‚æ— å•†å“</text>
      </view>

      <!-- åŠ è½½ä¸­ -->
      <view class="loading" wx:if="{{loading}}">
        <view class="loading-spinner"></view>
        <text>åŠ è½½ä¸­...</text>
      </view>
    </scroll-view>
  </view>
</view>
