<!--pages/category/category.wxml-->
<view class="container">
  <!-- 1. Sticky Search Header (White Bg) -->
  <view class="search-sticky-header">
    <view class="search-box" bindtap="onSearchTap">
      <image class="search-icon-img" src="/assets/icons/search.svg" style="width:32rpx;height:32rpx;" mode="aspectFit"></image>
      <text class="search-text">搜索精选商品</text>
    </view>
  </view>

  <!-- 2. Category Tabs - 方形滑动标签栏 -->
  <view class="category-tab-container">
    <scroll-view scroll-x scroll-with-animation show-scrollbar="{{false}}" class="category-tab-wrapper">
      <view class="category-tab-scroll">
        <view class="category-tab-item {{currentCategory === 0 ? 'active' : ''}}" 
              bindtap="onCategoryTap" data-id="{{0}}">
          <text class="category-tab-text">全部</text>
        </view>
        <view class="category-tab-item {{currentCategory === item.id ? 'active' : ''}}" 
              wx:for="{{categories}}" wx:key="id" 
              bindtap="onCategoryTap" data-id="{{item.id}}">
          <text class="category-tab-text">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- 3. Filter Bar - 方形滑动标签栏 -->
  <view class="filter-tab-container">
    <scroll-view scroll-x scroll-with-animation show-scrollbar="{{false}}" class="filter-tab-wrapper">
      <view class="filter-tab-scroll">
        <view class="filter-tab-item {{sortBy === 'default' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="default">
          <text class="filter-tab-text">综合</text>
        </view>
        <view class="filter-tab-item {{sortBy === 'sales' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="sales">
          <text class="filter-tab-text">销量</text>
        </view>
        <view class="filter-tab-item {{sortBy === 'price' ? 'active' : ''}}" 
              bindtap="onSortChange" data-sort="price">
          <text class="filter-tab-text">价格</text>
          <view class="sort-arrows">
            <text class="arrow up {{sortOrder === 'asc' ? 'on' : ''}}">▲</text>
            <text class="arrow down {{sortOrder === 'desc' ? 'on' : ''}}">▼</text>
          </view>
        </view>
      </view>
    </scroll-view>
    <view class="filter-icon-btn">
      <image src="/assets/icons/settings.svg" style="width:32rpx;height:32rpx;" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 4. Product List (Single Column) -->
  <scroll-view scroll-y class="product-list-scroll" bindscrolltolower="onLoadMore">
    <view class="product-list">
      <product-card 
        wx:for="{{products}}" 
        wx:key="id" 
        product="{{item}}" 
        mode="horizontal"
        bind:click="onProductTap"
      />
    </view>

    <!-- Loading / Empty -->
    <view class="loading-footer" wx:if="{{loading}}">
      <view class="spinner"></view>
      <text>加载中...</text>
    </view>
    <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
      <text>暂无相关商品</text>
    </view>
  </scroll-view>
</view>
