<!--pages/category/category.wxml-->
<view class="container">
  <!-- 1. Sticky Search Header (White Bg) -->
  <view class="search-sticky-header">
    <view class="search-box" bindtap="onSearchTap">
      <text class="search-icon">ğŸ”</text>
      <text class="search-text">æœç´¢ç²¾é€‰å•†å“</text>
    </view>
  </view>

  <!-- 2. Scenario Navigation (Horizontal Image Cards) -->
  <view class="scenario-section">
    <scroll-view scroll-x class="scenario-scroll" enable-flex>
      <!-- Active Item -->
      <view class="scenario-item {{currentCategory === 0 ? 'active' : ''}}" bindtap="onCategoryTap" data-id="{{0}}">
        <view class="scenario-img-box">
          <image src="/assets/images/category-all.svg" class="scenario-img" mode="aspectFill"></image> <!-- Placeholder -->
        </view>
        <text class="scenario-text">å…¨éƒ¨</text>
      </view>
      <!-- List Items -->
      <view class="scenario-item {{currentCategory === item.id ? 'active' : ''}}" 
            wx:for="{{categories}}" wx:key="id" 
            bindtap="onCategoryTap" data-id="{{item.id}}">
        <view class="scenario-img-box">
          <image src="{{item.icon || '/assets/images/placeholder.svg'}}" class="scenario-img" mode="aspectFill"></image>
        </view>
        <text class="scenario-text">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- 3. Filter Bar (Sticky below header) -->
  <view class="filter-sticky-bar">
    <view class="filter-row">
      <view class="filter-item {{sortBy === 'default' ? 'active' : ''}}" bindtap="onSortChange" data-sort="default">
        ç»¼åˆ
        <view class="active-indicator" wx:if="{{sortBy === 'default'}}"></view>
      </view>
      <view class="filter-item {{sortBy === 'sales' ? 'active' : ''}}" bindtap="onSortChange" data-sort="sales">
        é”€é‡
      </view>
      <view class="filter-item {{sortBy === 'price' ? 'active' : ''}}" bindtap="onSortChange" data-sort="price">
        ä»·æ ¼
        <view class="sort-arrows">
          <text class="arrow up {{sortOrder === 'asc' ? 'on' : ''}}">â–²</text>
          <text class="arrow down {{sortOrder === 'desc' ? 'on' : ''}}">â–¼</text>
        </view>
      </view>
    </view>
    <view class="filter-icon-btn">
      <text class="material-icon">âš™ï¸</text>
    </view>
  </view>

  <!-- 4. Product List (Single Column) -->
  <scroll-view scroll-y class="product-list-scroll" bindscrolltolower="onLoadMore">
    <view class="product-list">
      <view class="product-item" wx:for="{{products}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
        <!-- Left Image -->
        <view class="item-img-box">
          <image src="{{item.image}}" mode="aspectFill" class="item-img"></image>
          <view class="item-tag" wx:if="{{item.is_hot}}">HOT</view>
        </view>
        
        <!-- Right Content -->
        <view class="item-content">
          <view class="item-info">
            <view class="item-title line-clamp-2">{{item.name}}</view>
            <view class="item-desc line-clamp-1">{{item.description || 'æš‚æ— æè¿°'}}</view>
          </view>
          
          <view class="item-bottom">
            <view class="item-price">
              <text class="currency">Â¥</text>
              <text class="amount">{{item.price}}</text>
            </view>
            <!-- Black Circle Add Btn -->
            <view class="add-btn-circle" catchtap="onQuickAdd" data-item="{{item}}">
              <text class="plus-icon">+</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- Loading / Empty -->
    <view class="loading-footer" wx:if="{{loading}}">
      <view class="spinner"></view>
      <text>Loading...</text>
    </view>
    <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
      <text>æš‚æ— ç›¸å…³å•†å“</text>
    </view>
  </scroll-view>
</view>
