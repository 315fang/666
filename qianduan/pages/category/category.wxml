<!--pages/category/category.wxml-->
<view class="container">
  <!-- 1. Sticky Search Header (White Bg) -->
  <view class="search-sticky-header">
    <view class="search-box" bindtap="onSearchTap">
      <image class="search-icon-img" src="/assets/icons/search.svg" style="width:32rpx;height:32rpx;" mode="aspectFit"></image>
      <text class="search-text">搜索精选商品</text>
    </view>
  </view>

  <!-- 2. Scenario Navigation (Horizontal Image Cards) -->
  <view class="scenario-section">
    <scroll-view scroll-x class="scenario-scroll" enable-flex>
      <!-- Active Item -->
      <view class="scenario-item {{currentCategory === 0 ? 'active' : ''}}" bindtap="onCategoryTap" data-id="{{0}}">
        <view class="scenario-img-box">
          <image src="/assets/images/category-all.svg" class="scenario-img" mode="aspectFill"></image> <!-- Placeholder -->
        </view>
        <text class="scenario-text">全部</text>
      </view>
      <!-- List Items -->
      <view class="scenario-item {{currentCategory === item.id ? 'active' : ''}}" 
            wx:for="{{categories}}" wx:key="id" 
            bindtap="onCategoryTap" data-id="{{item.id}}">
        <view class="scenario-img-box">
          <image src="{{item.icon || '/assets/images/placeholder.svg'}}" class="scenario-img" mode="aspectFill"></image>
        </view>
        <text class="scenario-text">{{item.name}}</text>
      </view>
    </scroll-view>
  </view>

  <!-- 3. Filter Bar (Sticky below header) -->
  <view class="filter-sticky-bar">
    <view class="filter-row">
      <view class="filter-item {{sortBy === 'default' ? 'active' : ''}}" bindtap="onSortChange" data-sort="default">
        综合
        <view class="active-indicator" wx:if="{{sortBy === 'default'}}"></view>
      </view>
      <view class="filter-item {{sortBy === 'sales' ? 'active' : ''}}" bindtap="onSortChange" data-sort="sales">
        销量
      </view>
      <view class="filter-item {{sortBy === 'price' ? 'active' : ''}}" bindtap="onSortChange" data-sort="price">
        价格
        <view class="sort-arrows">
          <text class="arrow up {{sortOrder === 'asc' ? 'on' : ''}}">▲</text>
          <text class="arrow down {{sortOrder === 'desc' ? 'on' : ''}}">▼</text>
        </view>
      </view>
    </view>
    <view class="filter-icon-btn">
      <image src="/assets/icons/settings.svg" style="width:32rpx;height:32rpx;" mode="aspectFit"></image>
    </view>
  </view>

  <!-- 4. Product List (Single Column) -->
  <scroll-view scroll-y class="product-list-scroll" bindscrolltolower="onLoadMore">
    <view class="product-list">
      <view class="product-item" wx:for="{{products}}" wx:key="id" bindtap="onProductTap" data-id="{{item.id}}">
        <!-- Left Image -->
        <view class="item-img-box">
          <image src="{{item.image}}" mode="aspectFill" class="item-img"></image>
          <view class="item-tag" wx:if="{{item.is_hot}}">HOT</view>
        </view>
        
        <!-- Right Content -->
        <view class="item-content">
          <view class="item-info">
            <view class="item-title line-clamp-2">{{item.name}}</view>
            <view class="item-desc line-clamp-1">{{item.description || '暂无描述'}}</view>
          </view>
          
          <view class="item-bottom">
            <view class="item-price">
              <text class="currency">¥</text>
              <text class="amount">{{item.price}}</text>
            </view>
            <!-- Black Circle Add Btn -->
            <view class="add-btn-circle" catchtap="onQuickAdd" data-item="{{item}}">
              <text class="plus-icon">+</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- Loading / Empty -->
    <view class="loading-footer" wx:if="{{loading}}">
      <view class="spinner"></view>
      <text>加载中...</text>
    </view>
    <view class="empty-state" wx:if="{{!loading && products.length === 0}}">
      <text>暂无相关商品</text>
    </view>
  </scroll-view>
</view>
