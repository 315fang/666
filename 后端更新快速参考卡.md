# âš¡ åç«¯æ›´æ–°å¿«é€Ÿå‚è€ƒå¡

> é€‚ç”¨äºï¼šä» s2b2c-backend æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
> æ›´æ–°æ—¶é—´ï¼šçº¦ 30-40 åˆ†é’Ÿ
> **æ‰“å°æ­¤é¡µï¼Œæ›´æ–°æ—¶å¯¹ç…§æ£€æŸ¥**

---

## ğŸš¨ æ›´æ–°å‰å¿…åšï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. å¤‡ä»½ä»£ç 
tar -czf ~/backup_$(date +%Y%m%d_%H%M).tar.gz /path/to/backend/

# 2. å¤‡ä»½æ•°æ®åº“
mysqldump -u root -p s2b2c_db > ~/db_backup_$(date +%Y%m%d_%H%M).sql

# 3. å¤‡ä»½é…ç½®
cp /path/to/backend/.env ~/env_backup_$(date +%Y%m%d)

# 4. åœæ­¢æœåŠ¡
pm2 stop all
```

---

## ğŸ“¦ éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶ï¼ˆ30åˆ†é’Ÿï¼‰

### ğŸ†• æ–°å¢æ–‡ä»¶ï¼ˆ10ä¸ªï¼Œå¿…é¡»ä¸Šä¼ ï¼‰

```
âœ… SECURITY.md
âœ… SERVICES.md
âœ… middleware/validation.js
âœ… services/CommissionService.js
âœ… services/OrderService.js
âœ… services/PricingService.js
âœ… services/OrderNumberService.js
âœ… services/CacheService.js
âœ… utils/logger.js
âœ… utils/taskLock.js
```

### ğŸ“ è¦†ç›–æ–‡ä»¶ï¼ˆé‡è¦çš„10ä¸ªï¼‰

```
â¬†ï¸ .env.example
â¬†ï¸ app.js
â¬†ï¸ server.js
â¬†ï¸ config/constants.js
â¬†ï¸ controllers/authController.js
â¬†ï¸ controllers/orderController.js
â¬†ï¸ routes/auth.js
â¬†ï¸ routes/orders.js
â¬†ï¸ routes/admin/index.js
â¬†ï¸ models/Product.js
```

### ğŸ¨ ç®¡ç†åå°ï¼ˆå¦‚æœ‰ä¿®æ”¹ï¼‰

```
â¬†ï¸ admin-ui/dist/ ï¼ˆæ•´ä¸ªç›®å½•ï¼‰
```

---

## âš™ï¸ .env é…ç½®æ›´æ–°ï¼ˆå¿…åšï¼ï¼‰

ç¼–è¾‘æœåŠ¡å™¨ä¸Šçš„ `.env` æ–‡ä»¶ï¼Œæ·»åŠ /ä¿®æ”¹ï¼š

```ini
# JWT å¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼Œå¦åˆ™å¯åŠ¨å¤±è´¥ï¼ï¼‰
JWT_SECRET=è‡³å°‘32ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²abcdefghijklmn
ADMIN_JWT_SECRET=å¦ä¸€ä¸ªè‡³å°‘32ä¸ªå­—ç¬¦çš„éšæœºå­—ç¬¦ä¸²abcdefg

# CORS é…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
CORS_ORIGINS=https://api.jxalk.cn,https://admin.jxalk.cn

# è°ƒè¯•å¼€å…³ï¼ˆç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¸º falseï¼‰
ENABLE_DEBUG_ROUTES=false
ENABLE_TEST_ROUTES=false
ALLOW_OPENID_AUTH=false
```

---

## âœ… å¯åŠ¨å’ŒéªŒè¯ï¼ˆ5åˆ†é’Ÿï¼‰

```bash
# 1. é‡å¯æœåŠ¡
pm2 restart all

# 2. æŸ¥çœ‹æ—¥å¿—ï¼ˆç¡®è®¤æ— é”™è¯¯ï¼‰
pm2 logs --lines 30

# 3. å¥åº·æ£€æŸ¥
curl https://api.jxalk.cn/health
# åº”è¿”å›: {"status":"ok",...}

# 4. æµ‹è¯• API
curl https://api.jxalk.cn/api/products | head
# åº”è¿”å›å•†å“æ•°æ®

# 5. ç®¡ç†åå°ç™»å½•
# è®¿é—®: https://api.jxalk.cn/admin/
# ç¡®è®¤èƒ½æ­£å¸¸ç™»å½•å’Œè®¿é—®

# 6. å°ç¨‹åºæµ‹è¯•
# æ‰“å¼€å°ç¨‹åºï¼Œç¡®è®¤ç™»å½•å’Œæ ¸å¿ƒåŠŸèƒ½æ­£å¸¸
```

---

## ğŸ”§ å¸¸è§é”™è¯¯é€ŸæŸ¥

### âŒ "JWT_SECRET must be at least 32 characters"

```bash
# ç¼–è¾‘ .envï¼Œç¡®ä¿å¯†é’¥è‡³å°‘32å­—ç¬¦
vi /path/to/backend/.env
JWT_SECRET=abcdefghijklmnopqrstuvwxyz123456  # è‡³å°‘32å­—ç¬¦
```

### âŒ å°ç¨‹åºç™»å½• 400 é”™è¯¯

```bash
# æ£€æŸ¥ .env ä¸­å¾®ä¿¡é…ç½®
cat /path/to/backend/.env | grep WECHAT
# ç¡®ä¿ WECHAT_APPID å’Œ WECHAT_SECRET æ­£ç¡®
```

### âŒ ç®¡ç†åå°çœ‹ä¸åˆ°æ–°èœå•

```bash
# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
# Chrome: Ctrl+Shift+Delete
# æˆ–å¼ºåˆ¶åˆ·æ–°: Ctrl+Shift+R
```

### âŒ æ–‡ä»¶æƒé™é”™è¯¯

```bash
chown -R www-data:www-data /path/to/backend/
chmod -R 755 /path/to/backend/
```

---

## ğŸ”„ ç´§æ€¥å›æ»š

```bash
# 1. åœæ­¢æœåŠ¡
pm2 stop all

# 2. æ¢å¤ä»£ç 
cd /path/to
rm -rf backend
tar -xzf ~/backup_YYYYMMDD_HHMM.tar.gz

# 3. æ¢å¤é…ç½®
cp ~/env_backup_YYYYMMDD backend/.env

# 4. é‡å¯æœåŠ¡
pm2 restart all
```

---

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### æ›´æ–°å‰
- [ ] ä»£ç å·²å¤‡ä»½
- [ ] æ•°æ®åº“å·²å¤‡ä»½
- [ ] .env å·²å¤‡ä»½
- [ ] æœåŠ¡å·²åœæ­¢

### æ›´æ–°ä¸­
- [ ] æ–°æ–‡ä»¶å·²ä¸Šä¼ ï¼ˆ10ä¸ªï¼‰
- [ ] ä¿®æ”¹æ–‡ä»¶å·²è¦†ç›–ï¼ˆ10+ä¸ªï¼‰
- [ ] .env å·²æ›´æ–°
- [ ] admin-ui/dist å·²æ›´æ–°ï¼ˆå¦‚éœ€è¦ï¼‰

### æ›´æ–°å
- [ ] æœåŠ¡å¯åŠ¨æˆåŠŸï¼ˆpm2 list æ˜¾ç¤º onlineï¼‰
- [ ] å¥åº·æ£€æŸ¥é€šè¿‡ï¼ˆ/health è¿”å› okï¼‰
- [ ] ç®¡ç†åå°æ­£å¸¸ï¼ˆèƒ½ç™»å½•è®¿é—®ï¼‰
- [ ] å°ç¨‹åºæ­£å¸¸ï¼ˆèƒ½ç™»å½•ä½¿ç”¨ï¼‰
- [ ] æ—¥å¿—æ— é”™è¯¯ï¼ˆpm2 logs æ— çº¢è‰²é”™è¯¯ï¼‰

---

## ğŸ“ è·å–å¸®åŠ©

**è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ `åç«¯æ›´æ–°æŒ‡å—_å®Œæ•´ç‰ˆ.md`

**æ—¥å¿—ä½ç½®**:
```bash
pm2 logs s2b2c-backend --lines 100
```

**æŠ€æœ¯æ”¯æŒ**:
- æŸ¥çœ‹ `SECURITY.md` å’Œ `SERVICES.md`
- GitHub Issues: https://github.com/315fang/666/issues

---

**ğŸ’¡ æç¤º**:
- æ›´æ–°è¿‡ç¨‹ä¸­ä¿æŒå†·é™
- é‡åˆ°é”™è¯¯å…ˆæŸ¥çœ‹æ—¥å¿—
- ä¸ç¡®å®šæ—¶å¯ä»¥å…ˆå›æ»š
- æœ¬æ¬¡æ›´æ–°ä¸éœ€è¦ä¿®æ”¹æ•°æ®åº“
- ä¸éœ€è¦ npm install

**é¢„è®¡æ€»è€—æ—¶**: 30-40åˆ†é’Ÿ

**æ‰“å°æ—¥æœŸ**: _______________
**æ“ä½œäººå‘˜**: _______________
**å®Œæˆæ—¶é—´**: _______________
