# 🔧 快速故障排查清单

> 遇到问题时，按照这个清单逐项检查，快速定位问题！

## 🚨 紧急问题快速修复

### 问题：后端无法启动

```bash
# 第1步：检查 MySQL 是否运行
mysql --version
mysql -u root -p

# 第2步：检查端口是否被占用
# Windows
netstat -ano | findstr :3000
# Mac/Linux
lsof -i :3000

# 第3步：检查环境变量
cd backend
cat .env  # Mac/Linux
type .env # Windows

# 第4步：重新安装依赖
rm -rf node_modules package-lock.json
npm install

# 第5步：尝试启动
npm run dev
```

### 问题：小程序无法打开

```bash
# 第1步：检查后端是否运行
curl http://localhost:3000/health

# 第2步：检查小程序配置
# 打开 qianduan/config/env.js
# 确认第16行：const CURRENT_ENV = ENV_TYPES.DEVELOPMENT;

# 第3步：在微信开发者工具中
# - 点击"详情"
# - 勾选"不校验合法域名"
# - 点击"编译"
```

---

## 📋 系统性检查流程

### 第一关：环境检查

| 检查项 | 命令 | 预期结果 |
|--------|------|----------|
| Node.js | `node --version` | v16.0.0 或更高 |
| npm | `npm --version` | 8.0.0 或更高 |
| MySQL | `mysql --version` | 8.0 或更高 |
| 数据库存在 | `mysql -u root -p` 然后 `SHOW DATABASES;` | 看到 s2b2c_db |

### 第二关：后端检查

| 检查项 | 位置 | 检查内容 |
|--------|------|----------|
| .env 文件 | `backend/.env` | 文件存在 |
| 数据库密码 | `.env` 中 `DB_PASSWORD` | 和你的 MySQL 密码一致 |
| JWT 密钥 | `.env` 中 `JWT_SECRET` | 至少32个字符 |
| 依赖安装 | `backend/node_modules/` | 文件夹存在且有内容 |
| 服务运行 | 运行 `npm run dev` | 显示"服务器运行在..." |
| API 可访问 | 浏览器访问 `localhost:3000/health` | 显示 {"status":"ok"} |

### 第三关：前端检查

| 检查项 | 位置 | 检查内容 |
|--------|------|----------|
| 项目导入 | 微信开发者工具 | 已导入 qianduan 文件夹 |
| AppID | 项目设置 | 已填写或选择测试号 |
| 环境配置 | `qianduan/config/env.js` 第16行 | `ENV_TYPES.DEVELOPMENT` |
| 域名校验 | 详情 > 本地设置 | "不校验合法域名"已勾选 |
| 编译成功 | 编译按钮 | 无红色错误 |
| 页面显示 | 模拟器 | 能看到页面 |

---

## 🎯 常见错误速查

### Error: ER_ACCESS_DENIED_ERROR

**含义**：MySQL 密码错误

**解决**：
```bash
# 1. 检查 .env 文件中的 DB_PASSWORD
# 2. 确认密码正确
# 3. 重置 MySQL 密码（如果忘记）
mysql -u root -p
ALTER USER 'root'@'localhost' IDENTIFIED BY '新密码';
FLUSH PRIVILEGES;
```

### Error: ER_BAD_DB_ERROR

**含义**：数据库不存在

**解决**：
```sql
-- 登录 MySQL
mysql -u root -p

-- 创建数据库
CREATE DATABASE s2b2c_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 验证
SHOW DATABASES;
```

### Error: EADDRINUSE

**含义**：端口被占用

**解决**：
```bash
# Windows - 查找并杀死进程
netstat -ano | findstr :3000
taskkill /PID <进程ID> /F

# Mac/Linux
lsof -i :3000
kill -9 <PID>

# 或者改端口：编辑 .env 中的 PORT=3001
```

### ReferenceError: process is not defined

**含义**：小程序中使用了 Node.js 的 process 对象

**解决**：
```bash
# 检查 qianduan/config/env.js 第14-16行
# 应该是：
const CURRENT_ENV = ENV_TYPES.DEVELOPMENT;

# 不应该是：
# const CURRENT_ENV = process.env.NODE_ENV || ...
```

### Error: Cannot find module

**含义**：依赖包未安装

**解决**：
```bash
cd backend
rm -rf node_modules package-lock.json
npm install
```

### Error: JWT_SECRET must be at least 32 characters

**含义**：JWT 密钥太短

**解决**：
```bash
# 编辑 backend/.env
JWT_SECRET=随便输入一个很长的字符串至少需要32个字符哦加油
ADMIN_JWT_SECRET=另一个很长的字符串也要至少32个字符才行呢
```

---

## 🔍 调试工具使用

### 1. 查看后端日志

**位置**：运行 `npm run dev` 的命令行窗口

**关键信息**：
```
✅ 数据库连接成功        # 数据库正常
🚀 服务器运行在...        # 服务器正常
[API] GET /api/xxx      # API 被调用
[ERROR] xxx            # 发生错误
```

### 2. 查看小程序日志

**位置**：微信开发者工具 > 调试器 > Console

**关键信息**：
- 红色：错误
- 黄色：警告
- 白色：普通日志

### 3. 查看网络请求

**位置**：微信开发者工具 > 调试器 > Network

**检查内容**：
- Status：200 表示成功
- Response：查看返回的数据
- 时间：如果太长说明有性能问题

### 4. 查看数据库

**方法一：命令行**
```bash
mysql -u root -p
USE s2b2c_db;
SHOW TABLES;
SELECT * FROM users;
```

**方法二：图形化工具**
- MySQL Workbench
- Navicat
- DBeaver

---

## 📞 寻求帮助前的准备

收集以下信息会帮助更快解决问题：

### 1. 错误信息
```bash
# 完整的错误信息（包括堆栈跟踪）
# 截图或复制文本
```

### 2. 环境信息
```bash
node --version          # Node.js 版本
npm --version           # npm 版本
mysql --version         # MySQL 版本

# 操作系统
# Windows 10/11
# macOS 版本
# Linux 发行版
```

### 3. 已尝试的解决方案
```
- 已重启后端服务
- 已清除浏览器缓存
- 已重新安装依赖
- ...
```

### 4. 复现步骤
```
1. 打开小程序
2. 点击登录按钮
3. 出现错误提示...
```

---

## 🆘 紧急联系方式

### GitHub Issues
https://github.com/315fang/666/issues

### 文档资源
- 新手入门指南.md
- WECHAT_MINIPROGRAM_FIX.md
- README.md

### 在线文档
- [微信小程序文档](https://developers.weixin.qq.com/miniprogram/dev/framework/)
- [Node.js 文档](https://nodejs.org/docs/)
- [MySQL 文档](https://dev.mysql.com/doc/)

---

## ✅ 问题解决后

### 1. 记录解决方案
在项目根目录创建 `我的问题记录.md`，记录遇到的问题和解决方法。

### 2. 备份配置
```bash
# 创建配置备份
cp backend/.env backend/.env.backup
```

### 3. 提交代码
```bash
git add .
git commit -m "修复XXX问题"
git push
```

---

**记住：90% 的问题都是配置错误，仔细检查就能解决！** 💪
