# ğŸš€ æœåŠ¡å™¨æ›´æ–°æŒ‡å— - åˆ†ä½£ç³»ç»Ÿå®Œå–„ï¼ˆç¬¬2ç‰ˆï¼‰

> æ›´æ–°æ—¥æœŸï¼š2026å¹´2æœˆ8æ—¥  
> æœ¬æ¬¡æ›´æ–°å†…å®¹ï¼šåˆ†ä½£ä¸­å¿ƒæ•´åˆã€å›¢é˜Ÿå±•ç¤ºã€é‚€è¯·ç ç»‘å®šã€é€€è´§/é€€æ¬¾å…¨æµç¨‹ã€æç°å®¡æ ¸é€šçŸ¥ã€æ¶ˆæ¯é€šçŸ¥ç³»ç»Ÿã€ç®¡ç†åå°å¢å¼ºï¼ˆä»£ç†å•†åº“å­˜ç®¡ç† + è®¢å•è¯¦æƒ…æµç¨‹ï¼‰

---

## â“ å¸¸è§é—®é¢˜å…ˆå›ç­”

### Q: åå°ç®¡ç†ç½‘é¡µï¼ˆadmin-uiï¼‰éœ€è¦é‡æ–°æ„å»ºå—ï¼Ÿ
**éœ€è¦ï¼** æœ¬æ¬¡å¢å¼ºäº†ç®¡ç†åå°ï¼šç”¨æˆ·ç®¡ç†æ–°å¢äº†ã€Œä»£ç†å•†è¡¥å……åº“å­˜ã€åŠŸèƒ½ï¼Œè®¢å•ç®¡ç†æ–°å¢äº†ã€Œè®¢å•è¯¦æƒ…æŠ½å±‰ã€å¯æŸ¥çœ‹å®Œæ•´æµç¨‹çŠ¶æ€ã€‚  
æœ¬åœ°å·²ç»æ„å»ºå¥½äº†ï¼Œç›´æ¥ä¸Šä¼  `admin-ui/dist/` ç›®å½•è¦†ç›–å³å¯ã€‚

### Q: åç«¯éœ€è¦ npm install å—ï¼Ÿ
**ä¸éœ€è¦ï¼** æœ¬æ¬¡æ²¡æœ‰æ–°å¢ä»»ä½• npm ä¾èµ–åŒ…ã€‚

### Q: æ‰‹æœºç«¯æŠ¥400/ç½‘ç»œé”™è¯¯æ€ä¹ˆåŠï¼Ÿ
**æ£€æŸ¥æœåŠ¡å™¨ `.env` æ–‡ä»¶ï¼** 400é”™è¯¯å‡ ä¹100%æ˜¯å› ä¸º `.env` é‡Œçš„ `WECHAT_APPID` å’Œ `WECHAT_SECRET` ä¸¢å¤±æˆ–ä¸æ­£ç¡®ã€‚  
å…¶ä»–æ‰‹æœºæŠ¥ã€Œç½‘ç»œé”™è¯¯ã€ä¹Ÿæ˜¯åŒä¸€åŸå› ï¼šåç«¯å¯åŠ¨å¤±è´¥ï¼ˆæ•°æ®åº“è¿ä¸ä¸Šã€.envä¸¢å¤±ï¼‰å¯¼è‡´502ã€‚

---

## ğŸ“ éœ€è¦æ›´æ–°çš„æ–‡ä»¶æ¸…å•ï¼ˆå…±16ä¸ªæ–‡ä»¶ï¼‰

ä½ çš„æœåŠ¡å™¨ä¸Š backend ç›®å½•ç»“æ„å’Œæœ¬åœ°ä¸€è‡´ï¼ŒæŒ‰ä¸‹é¢çš„è·¯å¾„ä¸€ä¸€æ›¿æ¢å³å¯ã€‚

### ç¬¬ä¸€ç±»ï¼šæ–°å¢æ–‡ä»¶ï¼ˆæœåŠ¡å™¨ä¸ŠåŸæœ¬æ²¡æœ‰ï¼Œéœ€è¦æ–°ä¸Šä¼ ï¼‰

| åºå· | æœåŠ¡å™¨è·¯å¾„ | è¯´æ˜ |
|:---:|-----------|------|
| 1 | `backend/models/Notification.js` | é€šçŸ¥æ•°æ®æ¨¡å‹ï¼ˆæ–°è¡¨ï¼‰ |
| 2 | `backend/models/notificationUtil.js` | å‘é€é€šçŸ¥çš„å·¥å…·å‡½æ•° |
| 3 | `backend/routes/admin/controllers/adminRefundController.js` | åå°å”®åç®¡ç†æ§åˆ¶å™¨ |

### ç¬¬äºŒç±»ï¼šä¿®æ”¹æ–‡ä»¶ï¼ˆæœåŠ¡å™¨ä¸Šå·²æœ‰ï¼Œéœ€è¦ç”¨æœ¬åœ°æ–‡ä»¶è¦†ç›–æ›¿æ¢ï¼‰

| åºå· | æœåŠ¡å™¨è·¯å¾„ | æ”¹äº†ä»€ä¹ˆ |
|:---:|-----------|---------|
| 4 | `backend/models/index.js` | æ–°å¢ Notification æ¨¡å‹å¯¼å…¥å’Œå…³è”å…³ç³» |
| 5 | `backend/controllers/walletController.js` | æç°ç”³è¯·æ—¶å‘é€šçŸ¥ç»™ç”¨æˆ·å’Œç®¡ç†å‘˜ |
| 6 | `backend/controllers/refundController.js` | é€€æ¬¾ç”³è¯·æ—¶å‘é€šçŸ¥ç»™ç”¨æˆ·å’Œç®¡ç†å‘˜ |
| 7 | `backend/controllers/userController.js` | ç»‘å®šä¸Šçº§å‘é€šçŸ¥ + æ–°å¢è·å–é€šçŸ¥/æ ‡è®°å·²è¯»æ¥å£ |
| 8 | `backend/controllers/distributionController.js` | æ–°å¢æœ¬æœˆæ–°å¢æˆå‘˜(monthlyNewMembers)ç»Ÿè®¡ |
| 9 | `backend/routes/users.js` | æ–°å¢é€šçŸ¥ç›¸å…³è·¯ç”±ï¼ˆ/notificationsç­‰ï¼‰ |
| 10 | `backend/routes/refunds.js` | é€€æ¬¾è·¯ç”±ï¼ˆç¡®è®¤å·²å®Œæ•´ï¼‰ |
| 11 | `backend/routes/admin/index.js` | æ–°å¢åå°é€šçŸ¥æ¥å£ + å”®åç®¡ç†è·¯ç”±æŒ‚è½½ |
| 12 | `backend/routes/admin/controllers/adminWithdrawalController.js` | æç°å®¡æ ¸/æ‹’ç»/åˆ°è´¦æ—¶å‘é€šçŸ¥ |

### ç¬¬ä¸‰ç±»ï¼šç®¡ç†åå°å‰ç«¯ï¼ˆéœ€è¦æ•´ä¸ªç›®å½•è¦†ç›–ï¼‰

| åºå· | æœåŠ¡å™¨è·¯å¾„ | è¯´æ˜ |
|:---:|-----------|------|
| 13 | `backend/admin-ui/dist/` (æ•´ä¸ªç›®å½•) | ç®¡ç†åå°æ„å»ºäº§ç‰©ï¼ŒåŒ…å«ç”¨æˆ·åº“å­˜ç®¡ç†+è®¢å•è¯¦æƒ… |

> âš ï¸ ä¸Šä¼  `admin-ui/dist/` æ—¶è¦†ç›–æ•´ä¸ªç›®å½•å³å¯ã€‚**ä¸éœ€è¦**ä¸Šä¼  `admin-ui/node_modules/` å’Œ `admin-ui/src/`ã€‚

---

## ğŸ”§ æ“ä½œæ­¥éª¤

### æ­¥éª¤1: ä¸Šä¼ æ–‡ä»¶

å°†ä¸Šé¢12ä¸ªæ–‡ä»¶é€šè¿‡å®å¡”/1Panel/SFTPä¸Šä¼ åˆ°æœåŠ¡å™¨å¯¹åº”ä½ç½®ï¼Œ**ç›´æ¥è¦†ç›–åŒåæ–‡ä»¶**å³å¯ã€‚

ç›®å½•ç»“æ„å¯¹ç…§ï¼š
```
æœåŠ¡å™¨ä¸Šçš„ backend/
â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ Notification.js          â† æ–°ä¸Šä¼ 
â”‚   â”œâ”€â”€ notificationUtil.js      â† æ–°ä¸Šä¼   
â”‚   â””â”€â”€ index.js                 â† è¦†ç›–æ›¿æ¢
â”œâ”€â”€ controllers/
â”‚   â”œâ”€â”€ walletController.js      â† è¦†ç›–æ›¿æ¢
â”‚   â”œâ”€â”€ refundController.js      â† è¦†ç›–æ›¿æ¢
â”‚   â”œâ”€â”€ userController.js        â† è¦†ç›–æ›¿æ¢
â”‚   â””â”€â”€ distributionController.js â† è¦†ç›–æ›¿æ¢
â””â”€â”€ routes/
    â”œâ”€â”€ users.js                 â† è¦†ç›–æ›¿æ¢
    â”œâ”€â”€ refunds.js               â† è¦†ç›–æ›¿æ¢ï¼ˆç¡®è®¤å†…å®¹ä¸€è‡´å³å¯ï¼‰
    â””â”€â”€ admin/
        â”œâ”€â”€ index.js             â† è¦†ç›–æ›¿æ¢
        â””â”€â”€ controllers/
            â”œâ”€â”€ adminWithdrawalController.js  â† è¦†ç›–æ›¿æ¢
            â””â”€â”€ adminRefundController.js      â† æ–°ä¸Šä¼ 
```

### æ­¥éª¤2: åˆ›å»ºæ•°æ®åº“è¡¨

SSHç™»å½•æœåŠ¡å™¨ï¼Œè¿æ¥MySQLï¼Œæ‰§è¡Œï¼š

```sql
CREATE TABLE IF NOT EXISTS notifications (
  id INT AUTO_INCREMENT PRIMARY KEY,
  user_id INT NOT NULL COMMENT 'æ¥æ”¶é€šçŸ¥çš„ç”¨æˆ·ID, 0=ç®¡ç†å‘˜é€šçŸ¥',
  title VARCHAR(100) NOT NULL COMMENT 'é€šçŸ¥æ ‡é¢˜',
  content TEXT NOT NULL COMMENT 'é€šçŸ¥å†…å®¹',
  type VARCHAR(20) NOT NULL COMMENT 'é€šçŸ¥ç±»å‹',
  is_read TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦å·²è¯»',
  related_id VARCHAR(50) DEFAULT NULL COMMENT 'å…³è”ID',
  created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
  updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  INDEX idx_user_id (user_id),
  INDEX idx_type (type),
  INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='é€šçŸ¥æ¶ˆæ¯è¡¨';
```

> ğŸ’¡ å¦‚æœä½ çš„é¡¹ç›®å¯åŠ¨æ—¶å¼€å¯äº† `sequelize.sync()`ï¼Œè¿™ä¸ªè¡¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥ã€‚  
> æ£€æŸ¥æ–¹æ³•ï¼šçœ‹ `backend/server.js` æˆ– `backend/sync_db.js` é‡Œæœ‰æ²¡æœ‰ `sequelize.sync()`ã€‚

### æ­¥éª¤3: é‡å¯åç«¯æœåŠ¡

```bash
# å¦‚æœç”¨ pm2
pm2 restart all

# æˆ–è€…
pm2 restart zz-backend   # ä½ çš„pm2åº”ç”¨å

# å¦‚æœç”¨ systemd
systemctl restart zz-backend
```

### æ­¥éª¤4: éªŒè¯

é‡å¯åæ£€æŸ¥æ—¥å¿—ï¼Œç¡®è®¤æ²¡æœ‰å¯åŠ¨æŠ¥é”™ï¼š
```bash
pm2 logs --lines 30
```

ç„¶åå¯ä»¥æµ‹è¯•ä»¥ä¸‹æ¥å£ï¼š
```bash
# æµ‹è¯•é€šçŸ¥æ¥å£ï¼ˆéœ€è¦å¸¦tokenï¼‰
curl https://api.jxalk.cn/api/notifications -H "Authorization: Bearer YOUR_TOKEN"

# æµ‹è¯•åå°é€šçŸ¥
curl https://api.jxalk.cn/admin/api/dashboard/notifications -H "Authorization: Bearer ADMIN_TOKEN"
```

---

## ğŸ“± å°ç¨‹åºå‰ç«¯æ›´æ–°

å‰ç«¯æ–‡ä»¶ï¼ˆqianduan/ç›®å½•ï¼‰ä¸éœ€è¦ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œé€šè¿‡ **å¾®ä¿¡å¼€å‘è€…å·¥å…·** ä¸Šä¼ æ–°ç‰ˆæœ¬å³å¯ï¼š

1. åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­æ‰“å¼€ `qianduan/` é¡¹ç›®
2. ç‚¹å‡»å³ä¸Šè§’ã€Œä¸Šä¼ ã€
3. å¡«å†™ç‰ˆæœ¬å·ï¼Œæäº¤å®¡æ ¸

æœ¬æ¬¡å‰ç«¯æ”¹åŠ¨çš„æ–‡ä»¶ï¼ˆä¾›å‚è€ƒï¼‰ï¼š
- `app.json` - æ³¨å†Œæ–°é¡µé¢
- `pages/distribution/center.*` - åˆ†ä½£ä¸­å¿ƒï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- `pages/distribution/team.*` - å›¢é˜Ÿé¡µé¢ï¼ˆ4ä¸ªæ–‡ä»¶ï¼‰
- `pages/order/refund-apply.*` - é€€æ¬¾ç”³è¯·ï¼ˆ4ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ï¼‰
- `pages/order/refund-list.*` - é€€æ¬¾åˆ—è¡¨ï¼ˆ4ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ï¼‰
- `pages/order/refund-detail.*` - é€€æ¬¾è¯¦æƒ…ï¼ˆ4ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ï¼‰
- `pages/order/detail.js` + `detail.wxml` - è®¢å•è¯¦æƒ…ï¼ˆåŠ é€€æ¬¾æŒ‰é’®ï¼‰
- `pages/user/notifications.*` - é€šçŸ¥é¡µé¢ï¼ˆ4ä¸ªæ–‡ä»¶ï¼Œæ–°å¢ï¼‰

---

## âœ… æ›´æ–°æ ¸å¯¹æ¸…å•

- [ ] ä¸Šä¼ 3ä¸ªæ–°æ–‡ä»¶åˆ°æœåŠ¡å™¨
- [ ] è¦†ç›–9ä¸ªä¿®æ”¹æ–‡ä»¶åˆ°æœåŠ¡å™¨
- [ ] æ‰§è¡ŒSQLåˆ›å»º notifications è¡¨ï¼ˆæˆ–ç¡®è®¤ sync è‡ªåŠ¨åˆ›å»ºï¼‰
- [ ] é‡å¯åç«¯æœåŠ¡ï¼ˆpm2 restartï¼‰
- [ ] æ£€æŸ¥å¯åŠ¨æ—¥å¿—æ— æŠ¥é”™
- [ ] å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸Šä¼ å°ç¨‹åºæ–°ç‰ˆæœ¬
- [ ] æµ‹è¯•ï¼šåˆ†ä½£ä¸­å¿ƒé¡µé¢æ­£å¸¸å±•ç¤º
- [ ] æµ‹è¯•ï¼šå¡«å†™é‚€è¯·ç ç»‘å®šä¸Šçº§
- [ ] æµ‹è¯•ï¼šç”³è¯·é€€æ¬¾æµç¨‹
- [ ] æµ‹è¯•ï¼šé€šçŸ¥åˆ—è¡¨æ­£å¸¸
