# åç«¯éƒ¨ç½²æ–‡ä»¶æ¸…å•

## âœ… å¿…é¡»ä¸Šä¼ çš„æ–‡ä»¶/æ–‡ä»¶å¤¹

```
backend/
â”œâ”€â”€ app.js                 âœ… ä¸»åº”ç”¨ï¼ˆä¿®æ”¹äº†CORSå’ŒCSPï¼‰
â”œâ”€â”€ server.js              âœ… å¯åŠ¨å…¥å£
â”œâ”€â”€ package.json           âœ… ä¾èµ–åˆ—è¡¨ï¼ˆæ–°å¢äº†express-rate-limitï¼‰
â”œâ”€â”€ sync_db.js             âœ… æ•°æ®åº“åŒæ­¥è„šæœ¬
â”œâ”€â”€ controllers/           âœ… å…¨éƒ¨ä¸Šä¼ ï¼ˆä¿®æ”¹äº†orderController.js, authController.js, userController.jsï¼‰
â”‚   â”œâ”€â”€ addressController.js
â”‚   â”œâ”€â”€ authController.js         ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ cartController.js
â”‚   â”œâ”€â”€ categoryController.js
â”‚   â”œâ”€â”€ contentController.js
â”‚   â”œâ”€â”€ dealerController.js
â”‚   â”œâ”€â”€ distributionController.js
â”‚   â”œâ”€â”€ materialController.js
â”‚   â”œâ”€â”€ orderController.js        ã€æ”¹ã€‘é‡ç‚¹ï¼
â”‚   â”œâ”€â”€ partnerController.js
â”‚   â”œâ”€â”€ productController.js
â”‚   â”œâ”€â”€ refundController.js
â”‚   â”œâ”€â”€ userController.js         ã€æ”¹ã€‘
â”‚   â””â”€â”€ walletController.js
â”œâ”€â”€ middleware/            âœ… å…¨éƒ¨ä¸Šä¼ ï¼ˆä¿®æ”¹äº†auth.jsï¼‰
â”‚   â”œâ”€â”€ adminAuth.js
â”‚   â”œâ”€â”€ auth.js                   ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ errorHandler.js
â”‚   â””â”€â”€ validate.js
â”œâ”€â”€ models/                âœ… å…¨éƒ¨ä¸Šä¼ ï¼ˆä¿®æ”¹äº†Order.js, Notification.js, index.jsï¼‰
â”‚   â”œâ”€â”€ Address.js
â”‚   â”œâ”€â”€ Admin.js
â”‚   â”œâ”€â”€ Banner.js
â”‚   â”œâ”€â”€ Cart.js
â”‚   â”œâ”€â”€ Category.js
â”‚   â”œâ”€â”€ CommissionLog.js
â”‚   â”œâ”€â”€ Content.js
â”‚   â”œâ”€â”€ Dealer.js
â”‚   â”œâ”€â”€ index.js                  ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ Material.js
â”‚   â”œâ”€â”€ Notification.js           ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ notificationUtil.js
â”‚   â”œâ”€â”€ Order.js                  ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ Product.js
â”‚   â”œâ”€â”€ Refund.js
â”‚   â”œâ”€â”€ SKU.js
â”‚   â”œâ”€â”€ User.js
â”‚   â””â”€â”€ Withdrawal.js
â”œâ”€â”€ routes/                âœ… å…¨éƒ¨ä¸Šä¼ ï¼ˆä¿®æ”¹äº†orders.js, users.js, debug.jsï¼‰
â”‚   â”œâ”€â”€ addresses.js
â”‚   â”œâ”€â”€ auth.js
â”‚   â”œâ”€â”€ cart.js
â”‚   â”œâ”€â”€ categories.js
â”‚   â”œâ”€â”€ content.js
â”‚   â”œâ”€â”€ dealer.js
â”‚   â”œâ”€â”€ debug.js                  ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ distribution.js
â”‚   â”œâ”€â”€ materials.js
â”‚   â”œâ”€â”€ orders.js                 ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ partner.js
â”‚   â”œâ”€â”€ products.js
â”‚   â”œâ”€â”€ refunds.js
â”‚   â”œâ”€â”€ users.js                  ã€æ”¹ã€‘
â”‚   â”œâ”€â”€ wallet.js
â”‚   â””â”€â”€ admin/                    âœ… æ•´ä¸ªæ–‡ä»¶å¤¹
â”œâ”€â”€ config/                âœ… ä¸Šä¼ 
â”‚   â””â”€â”€ database.js
â”œâ”€â”€ utils/                 âœ… ä¸Šä¼ 
â”‚   â”œâ”€â”€ commission.js
â”‚   â””â”€â”€ wechat.js
â”œâ”€â”€ scripts/               âœ… ä¸Šä¼ 
â”‚   â””â”€â”€ create-admin.js
â””â”€â”€ seeds/                 âœ… ä¸Šä¼ 
    â””â”€â”€ init.sql
```

## âŒ åƒä¸‡ä¸è¦ä¸Šä¼ çš„

```
backend/
â”œâ”€â”€ .env                   âŒ æœ¬åœ°é…ç½®ï¼ŒæœåŠ¡å™¨æœ‰è‡ªå·±çš„
â”œâ”€â”€ node_modules/          âŒ å¤ªå¤§ï¼æœåŠ¡å™¨ä¸Šç”¨ npm install ç”Ÿæˆ
â”œâ”€â”€ admin-ui/src/          âŒ æºç ä¸éœ€è¦ï¼Œåªéœ€è¦æ„å»ºåçš„ dist
â”œâ”€â”€ admin-ui/node_modules/ âŒ å¤ªå¤§
â”œâ”€â”€ *.log                  âŒ æ—¥å¿—æ–‡ä»¶
â””â”€â”€ .git/                  âŒ Gitä»“åº“ï¼ˆå¦‚æœæœ‰ï¼‰
```

## ğŸ“Œ éƒ¨ç½²åå¿…åšçš„æ“ä½œ

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# 1. å®‰è£…æ–°ä¾èµ–
cd /ä½ çš„æœåŠ¡å™¨è·¯å¾„/backend
npm install

# 2. åŒæ­¥æ•°æ®åº“ç»“æ„ï¼ˆOrderè¡¨åŠ äº†æ–°å­—æ®µï¼‰
node sync_db.js

# 3. é‡å¯æœåŠ¡
pm2 restart s2b2c-backend
# æˆ–è€…
pm2 restart server.js

# 4. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
pm2 logs s2b2c-backend --lines 20
```

## ğŸ¯ å¿«æ·ä¸Šä¼ æ–¹å¼

### æ–¹å¼1ï¼šFTP/SFTPï¼ˆæ¨èï¼‰
ä½¿ç”¨ FileZilla æˆ– WinSCPï¼ŒæŠŠæ•´ä¸ª `backend/` æ–‡ä»¶å¤¹ä¸Šä¼ ï¼ˆæ’é™¤ä¸Šé¢âŒçš„éƒ¨åˆ†ï¼‰

### æ–¹å¼2ï¼šGitï¼ˆå¦‚æœä½ ä¼šç”¨ï¼‰
```bash
git add .
git commit -m "ä¿®å¤JWTè®¤è¯+è®¢å•äº‹åŠ¡+åº“å­˜æ ¡éªŒ"
git push

# åœ¨æœåŠ¡å™¨ä¸Š
cd /ä½ çš„æœåŠ¡å™¨è·¯å¾„/backend
git pull
npm install
node sync_db.js
pm2 restart s2b2c-backend
```

### æ–¹å¼3ï¼šå‹ç¼©åŒ…
1. æŠŠ backend/ æ–‡ä»¶å¤¹å‹ç¼©ï¼ˆæ’é™¤ node_modules å’Œ .envï¼‰
2. ä¸Šä¼ åˆ°æœåŠ¡å™¨
3. è§£å‹å¹¶è¦†ç›–ï¼ˆä¿ç•™æœåŠ¡å™¨çš„ .envï¼‰
4. æ‰§è¡Œä¸Šé¢çš„éƒ¨ç½²åæ“ä½œ
